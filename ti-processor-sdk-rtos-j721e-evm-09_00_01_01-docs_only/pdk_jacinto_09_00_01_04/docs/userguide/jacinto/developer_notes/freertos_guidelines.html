

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9.1. FreeRTOS Usage and Migration Guidelines &mdash; Platform Development Kit (PDK) - JACINTO User Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Platform Development Kit (PDK) - JACINTO User Guide" href="../index.html"/>
        <link rel="up" title="9. Developer Notes" href="../family_cfg/jacinto/index_developer_notes_jacinto.html"/>
        <link rel="next" title="9.2. FreeRTOS Real-time Object View (ROV)" href="freertos_ccs_rov.html"/>
        <link rel="prev" title="9. Developer Notes" href="../family_cfg/jacinto/index_developer_notes_jacinto.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index_jacinto.html" class="icon icon-home"> Platform Development Kit (PDK) - JACINTO User Guide
          

          
          </a>

          
            
            
              <div class="version">
                09_00_01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_release_notes_jacinto.html">2. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_modules_jacinto.html">4. Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_boot_jacinto.html">5. Bootloader (SBL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_board_jacinto.html">6. Board/EVM Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_howto_jacinto.html">7. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/jacinto/index_faq_jacinto.html">8. Frequently Asked Questions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../family_cfg/jacinto/index_developer_notes_jacinto.html">9. Developer Notes</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">9.1. FreeRTOS Usage and Migration Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#freertos-configuration-1">9.1.1. FreeRTOS configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary-comparison-with-sysbios">9.1.2. Summary Comparison with SysBIOS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#key-similarities-between-modules">9.1.2.1. Key similarities between modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-differences-between-modules">9.1.2.2. Key differences between modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#freertos-usage-guidelines-1">9.1.3. FreeRTOS Usage Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#freertos-tasks">9.1.3.1. FreeRTOS Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-interrupts">9.1.3.2. FreeRTOS Interrupts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-semaphores-and-mutex">9.1.3.3. FreeRTOS Semaphores and Mutex</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-task-notification">9.1.3.4. FreeRTOS Task Notification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-event-groups">9.1.3.5. FreeRTOS Event Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-timers">9.1.3.6. FreeRTOS Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-heaps">9.1.3.7. FreeRTOS Heaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-additional-modules">9.1.3.8. FreeRTOS Additional Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freertos-hook-functions">9.1.3.9. FreeRTOS Hook Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#freertos-migration-guidelines-1">9.1.4. FreeRTOS Migration Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#porting-of-source-files">9.1.4.1. Porting of source files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-with-freertos">9.1.4.2. Building with FreeRTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linker-file-for-freertos">9.1.4.3. Linker file for FreeRTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mpu-cache-settings-in-freertos">9.1.4.4. MPU/Cache Settings in FreeRTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exception-handling-in-freertos">9.1.4.5. Exception handling in FreeRTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset-hook-function-alternative-for-freertos">9.1.4.6. Reset Hook Function Alternative for FreeRTOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-comparison">9.1.5. API Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scheduler-general">9.1.5.1. Scheduler / General</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tasks">9.1.5.2. Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#semaphores">9.1.5.3. Semaphores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutex">9.1.5.4. Mutex</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-timers">9.1.5.5. Software Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events">9.1.5.6. Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mailbox">9.1.5.7. Mailbox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#queue">9.1.5.8. Queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arbitrary-heaps">9.1.5.9. Arbitrary Heaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-cpu-load">9.1.5.10. Task / CPU Load</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cache-operations">9.1.5.11. Cache Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hw-interrupts">9.1.5.12. HW Interrupts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hw-timers">9.1.5.13. HW Timers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#faq-important-notes-1">9.1.6. FAQ / Important Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#app-performance-with-freertos-is-very-low-compared-to-sysbios">9.1.6.1. App performance with FreeRTOS is very low compared to SysBIOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-never-reaches-main-and-startupcode-startupdata-bootcode-is-not-found-in-the-map-file">9.1.6.2. Application never reaches main() and .startUpCode, .startUpData, .bootCode is not found in the map file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="freertos_ccs_rov.html">9.2. FreeRTOS Real-time Object View (ROV)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipc_lld_migration_guide.html">9.3. IPC LLD Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="xip_using_dummy_app.html">9.4. XIP Using Dummy App</a></li>
<li class="toctree-l2"><a class="reference internal" href="xip_using_two_appimages.html">9.5. XIP Using Two Appimages</a></li>
<li class="toctree-l2"><a class="reference internal" href="ticlang_Migrationguidelines.html">9.6. TI ARM CLANG Usage and Migration Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos_to_safertos_migration.html">9.7. SafeRTOS Usage and Migration Guidelines</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index_jacinto.html">Platform Development Kit (PDK) - JACINTO User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index_jacinto.html">Docs</a> &raquo;</li>
      
          <li><a href="../family_cfg/jacinto/index_developer_notes_jacinto.html"><span class="section-number">9. </span>Developer Notes</a> &raquo;</li>
      
    <li><span class="section-number">9.1. </span>FreeRTOS Usage and Migration Guidelines</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="freertos-usage-and-migration-guidelines-1">
<span id="freertos-usage-and-migration-guidelines"></span><h1><span class="section-number">9.1. </span>FreeRTOS Usage and Migration Guidelines<a class="headerlink" href="#freertos-usage-and-migration-guidelines-1" title="Permalink to this headline">¶</a></h1>
<p>This section has additional useful information related to FreeRTOS and its integration within PDK.
<strong>It also compares some key points &amp; config in FreeRTOS vs TI SysBIOS RTOS and the guidelines for migrating to FreeRTOS from TI SysBIOS.</strong></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#freertos-configuration"><span class="std std-ref">FreeRTOS configuration</span></a></p></li>
<li><p><a class="reference internal" href="#freertos-comparison-with-sysbios"><span class="std std-ref">Summary Comparison with SysBIOS</span></a></p></li>
<li><p><a class="reference internal" href="#freertos-usage-guidelines"><span class="std std-ref">FreeRTOS Usage Guidelines</span></a></p></li>
<li><p><a class="reference internal" href="#freertos-migration-guidelines"><span class="std std-ref">FreeRTOS Migration Guidelines</span></a></p></li>
<li><p><a class="reference internal" href="#freertos-sysbios-osal-api-comparison"><span class="std std-ref">API Comparison</span></a></p></li>
<li><p><a class="reference internal" href="#faq-important-notes"><span class="std std-ref">FAQ / Important Notes</span></a></p></li>
</ol>
<section id="freertos-configuration-1">
<span id="freertos-configuration"></span><h2><span class="section-number">9.1.1. </span>FreeRTOS configuration<a class="headerlink" href="#freertos-configuration-1" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>In FreeRTOS, all applications need to provide a <cite>FreeRTOSConfig.h</cite> file which specifies the FreeRTOS kernel configuration, see <a class="reference external" href="https://www.freertos.org/a00110.html">https://www.freertos.org/a00110.html</a></p></li>
<li><p>All source code using FreeRTOS APIs, including FreeRTOS kernel itself MUST include “FreeRTOSConfig.h” before any other FreeRTOS .h files.</p>
<ul>
<li><p>This is because <cite>FreeRTOSConfig.h</cite> tailors the RTOS kernel to the application being built. It is therefore specific to the application, not the RTOS.</p></li>
<li><p>For example,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;FreeRTOSConfig.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;FreeRTOS.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;task.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;semphr.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;event_groups.h&gt;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Configuration includes things like below</p>
<ul class="simple">
<li><p>Task scheduling options, Timer tick resolution, Number of priorities, Debug and trace hooks</p></li>
<li><p>Enable / Disable RTOS features, mainly:- task, mutex, recursive mutex, semaphore, etc</p></li>
<li><p>Default sizes for task stack, timer task, idle task, etc</p></li>
</ul>
</li>
<li><p>To allow support of pre-built libraries, PDK has a default predefined <cite>FreeRTOSConfig.h</cite> per SOC and per CPU type</p>
<ul class="simple">
<li><dl class="simple">
<dt>The predefined config file per SOC and per CPU can be found at below path</dt><dd><ul>
<li><p>${PDK_INSTALL_PATH}/packages/ti/kernel/freertos/config/j721e/{cpu}/FreeRTOSConfig.h</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
<li><p>In general extreme fine-tuning of FreeRTOS config is not needed and a predefined config per SOC and CPU type would meet almost all use-cases and applications.</p></li>
<li><p>Also many config options are related to the inclusion/exclusion of RTOS modules to save code/data size. However, we can rely on the compiler to optimize out functions that are not called by applications.</p></li>
<li><p>However, the user can modify this config if needed.  When default predefined <cite>FreeRTOSConfig.h</cite> is changed, all pre-built libraries have to be recompiled for the changes to take effect.</p>
<ul>
<li><p>To recompile all pre-built PDK libraries:-</p>
<pre class="literal-block">cd PDK_INSTALL_DIR/packages/ti/build
make -s pdk_libs_allcores_clean BOARD=j721e_evm
make -s pdk_libs_allcores BOARD=j721e_evm</pre>
</li>
</ul>
</li>
</ul>
</section>
<section id="summary-comparison-with-sysbios">
<span id="freertos-comparison-with-sysbios"></span><h2><span class="section-number">9.1.2. </span>Summary Comparison with SysBIOS<a class="headerlink" href="#summary-comparison-with-sysbios" title="Permalink to this headline">¶</a></h2>
<p>This section has a quick summary of the comparison between SysBIOS and FreeRTOS features.
Refer rest of the sections on this page for more details</p>
<section id="key-similarities-between-modules">
<h3><span class="section-number">9.1.2.1. </span>Key similarities between modules<a class="headerlink" href="#key-similarities-between-modules" title="Permalink to this headline">¶</a></h3>
<p>The following table compares various modules in SysBIOS vs FreeRTOS and the OSAL modules that are implemented.
OSAL modules which calls OS API’s underneath are provided to keep drivers/examples OS agnostic and also to support various
functionalities which are not present as part of FreeRTOS Kernel. For example, Cache, HW Interrupts, HW Timers, etc.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS Module</p></th>
<th class="head"><p>FreeRTOS Module</p></th>
<th class="head"><p>OSAL Module</p></th>
<th class="head"><p>Additional Remarks</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>XDC based config
(r5_mpu.xs)</p></td>
<td><p>FreeRTOSConfig.h</p></td>
<td><p>-NA-</p></td>
<td><p>#define based config, most code in C files for FreeRTOS</p></td>
</tr>
<tr class="row-odd"><td><p>Static alloc</p></td>
<td><p>Static alloc</p></td>
<td><p>-NA-</p></td>
<td><p>“construct” APIs in SysBIOS, “CreateStatic” APIs in FreeRTOS</p></td>
</tr>
<tr class="row-even"><td><p>Task</p></td>
<td><p>Task</p></td>
<td><p>TaskP</p></td>
<td><p>Same scheduling policy as SysBIOS</p></td>
</tr>
<tr class="row-odd"><td><p>Semaphore</p></td>
<td><p>Semaphore</p></td>
<td><p>SemaphoreP</p></td>
<td><p>Same as SysBIOS. Binary, counting semaphore’s</p></td>
</tr>
<tr class="row-even"><td><p>GateMutex</p></td>
<td><p>Mutex</p></td>
<td><p>MutexP</p></td>
<td><p>Same as SysBIOS. Recursive, priority inheritance mutex’s</p></td>
</tr>
<tr class="row-odd"><td><p>Clock</p></td>
<td><p>Timer</p></td>
<td><p>ClockP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-even"><td><p>Event</p></td>
<td><p>Event Groups</p></td>
<td><p>EventP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-odd"><td><p>Idle</p></td>
<td><p>Idle</p></td>
<td><p>-NA-</p></td>
<td><p>Only one idle hook function is supported in FreeRTOS.
SysBIOS supported multiple idle functions.</p></td>
</tr>
<tr class="row-even"><td><p>Queue</p></td>
<td><p>List</p></td>
<td><p>QueueP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-odd"><td><p>Mailbox</p></td>
<td><p>Queue</p></td>
<td><p>MailboxP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-even"><td><p>Hwi</p></td>
<td><p>-NA-</p></td>
<td><p>HwiP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-odd"><td><p>Cache</p></td>
<td><p>-NA-</p></td>
<td><p>CacheP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-even"><td><p>HeapMem</p></td>
<td><p>-NA-</p></td>
<td><p>HeapP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-odd"><td><p>MPU/MMU</p></td>
<td><p>-NA-</p></td>
<td><p>MPU/MMU in CSL</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-even"><td><p>Swi</p></td>
<td><p>“Pend” function call</p></td>
<td><p>-NA-</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
<tr class="row-odd"><td><p>Load</p></td>
<td><p>Run-time stats APIs</p></td>
<td><p>LoadP</p></td>
<td><p>Similar features, see details below</p></td>
</tr>
</tbody>
</table>
</section>
<section id="key-differences-between-modules">
<h3><span class="section-number">9.1.2.2. </span>Key differences between modules<a class="headerlink" href="#key-differences-between-modules" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>FreeRTOS difference vs SysBIOS</p></th>
<th class="head"><p>Alternative in FreeRTOS</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>When configUSE_TIME_SLICING is 1,
FreeRTOS will time slice between tasks at the same priority
(This was no supported in SysBIOS)</p></td>
<td><p>Keep this at 0 (<strong>PDK default config</strong>), if this is not desired</p></td>
</tr>
<tr class="row-odd"><td><p>Timer callbacks are called in task context in FreeRTOS vs
ISR context in SysBIOS</p></td>
<td><p>Keep the timer task to highest priority so that timer callback get called
immediately after all ISRs are done (<strong>PDK default config</strong>)</p></td>
</tr>
<tr class="row-even"><td><p>No SWI support in FreeRTOS</p></td>
<td><p>Use “pend” function call, where functions are executed in timer task context.
Again keep timer task as the highest priority (<strong>PDK default config</strong>).
see <a class="reference external" href="https://www.freertos.org/xTimerPendFunctionCall.html">xTimerPendFunctionCall()</a> and
<a class="reference external" href="https://www.freertos.org/xTimerPendFunctionCallFromISR.html">xTimerPendFunctionCallFromISR()</a></p></td>
</tr>
<tr class="row-odd"><td><p>No ability to create arbitrary heaps in FreeRTOS</p></td>
<td><p>OSAL provides APIs in HeapP module to create arbitrary heaps to match SysBIOS</p></td>
</tr>
<tr class="row-even"><td><p>Only FreeRTOS APIs ending with “FromISR()” can be called
from within ISRs</p></td>
<td><p>Porting Layer provides a function <cite>xPortInIsrContext()</cite> to detect if code is in ISR.
This can be used to keep the application functions generic.
OSAL takes care of this by default.</p></td>
</tr>
<tr class="row-odd"><td><p>Number of task priorities in FreeRTOS is configurable
(up to max 32) vs SysBIOS default of 16</p></td>
<td><p><strong>PDK default config</strong> keeps number of task priorities to 16 in FreeRTOS</p></td>
</tr>
<tr class="row-even"><td><p>No Reset Hook Function support in FreeRTOS.</p></td>
<td><p>CSL Startup API <cite>_system_post_cinit</cite> can be redefined in the application
to achieve similar functionality. See <a class="reference internal" href="#reset-hook-alternative-for-freertos"><span class="std std-ref">Reset Hook Function Alternative for FreeRTOS</span></a>
for more details</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="freertos-usage-guidelines-1">
<span id="freertos-usage-guidelines"></span><h2><span class="section-number">9.1.3. </span>FreeRTOS Usage Guidelines<a class="headerlink" href="#freertos-usage-guidelines-1" title="Permalink to this headline">¶</a></h2>
<section id="freertos-tasks">
<h3><span class="section-number">9.1.3.1. </span>FreeRTOS Tasks<a class="headerlink" href="#freertos-tasks" title="Permalink to this headline">¶</a></h3>
<section id="overview">
<h4><span class="section-number">9.1.3.1.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS has the ability to create tasks with the below parameters:</p>
<ul>
<li><p>Entry function</p></li>
<li><p>One <cite>void *</cite> entry function argument</p></li>
<li><p>Stack memory (when NULL, FreeRTOS uses the default heap to allocate the stack memory)</p></li>
<li><p>Stack size in units of “stack words”, i.e 32b or 4 bytes in case of R5F and C66x.</p></li>
<li><p>Priority (0 is lowest, <cite>configMAX_PRIORITY-1</cite> is the highest)</p>
<ul>
<li><p><strong>PDK default config is 16 priorities to match SysBIOS priorities</strong></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Static task object memory allocation is supported</p>
<ul>
<li><p>PDK examples and OSAL by default use static alloc APIs</p></li>
</ul>
</li>
<li><p>Scheduler policy is configurable</p>
<ul>
<li><p><cite>configUSE_PREEMPTION</cite>, <strong>PDK default is 1 to match SysBIOS scheduler policy</strong></p>
<ul>
<li><p>This enables pre-emptive priority-based scheduling</p></li>
</ul>
</li>
<li><p><cite>configUSE_TIME_SLICING</cite>, <strong>PDK default is 0, i.e. disabled, to match SysBIOS scheduler policy</strong></p>
<ul>
<li><p>If enabled, when two tasks are of the same priority, FreeRTOS will time-slice between the tasks at units of the timer tick</p></li>
<li><p><strong>NOTE, this is unlike SysBIOS where unless `Task_yeild` is called scheduler will not switch to another task at the same priority</strong></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="initial-tasks">
<h4><span class="section-number">9.1.3.1.2. </span>Initial Tasks<a class="headerlink" href="#initial-tasks" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Two tasks are created inside FreeRTOS on startup, idle task and timer task</p></li>
<li><p>Idle task is similar to any other task, only it runs at lowest priority.</p>
<ul>
<li><p>User can configure a “hook” function to call inside of IDLE, e.g, WFI can be called here.</p></li>
<li><p>PDK default config is shown below, <cite>vApplicationIdleHook</cite> calls a periodic load update API</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* in FreeRTOSConfig.h file */</span>
<span class="cp">#define configUSE_IDLE_HOOK                     (1)</span>

<span class="cm">/* in port.c file for R5F and C66x */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">vApplicationIdleHook</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if (configLOAD_UPDATE_IN_IDLE==1)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">vApplicationLoadHook</span><span class="p">();</span>

<span class="w">    </span><span class="n">vApplicationLoadHook</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>NOTE, unlike SysBIOS, only one idle hook function (`vApplicationIdleHook`) is supported in FreeRTOS</strong></p>
<ul class="simple">
<li><p>SysBIOS supported multiple functions to be called when no other Tasks are running.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Timer task (<strong>PDK default config enables timer task to match SysBIOS</strong>),</p>
<ul>
<li><p>Timer callbacks and “deferred” interrupt handler functions are called in the context of the timer task</p></li>
<li><p><strong>NOTE, unlike SysBIOS, SW timer callbacks are not called in ISR context</strong></p></li>
<li><p>“deferred”  handler functions, can be used as an equivalent of SW interrupt of SysBIOS</p></li>
<li><p><strong>NOTE, unlike SysBIOS, there is no SWI module in FreeRTOS</strong></p></li>
<li><p>PDK config keeps the priority of this task to the highest so that the timer function will run immediately after an ISR</p></li>
<li><p>All of above can be controlled via FreeRTOS Config, PDK defaults are listed below</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define configUSE_TIMERS               (1) </span><span class="cm">/* enable timer task and SW timers */</span>
<span class="cp">#define configTIMER_TASK_PRIORITY      (configMAX_PRIORITIES - 1) </span><span class="cm">/* highest priority */</span>
<span class="cp">#define configTIMER_TASK_STACK_DEPTH   (256) </span><span class="cm">/* 1KB */</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="task-load">
<h4><span class="section-number">9.1.3.1.3. </span>Task load<a class="headerlink" href="#task-load" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>To measure task and CPU load, in FreeRTOS config, we need to set <cite>configGENERATE_RUN_TIME_STATS</cite> to <cite>1</cite> (<strong>PDK default</strong> is <cite>1</cite> when <cite>configOPTIMIZE_FOR_LATENCY</cite> is <cite>0</cite>)</p></li>
<li><p>When load measurement is enabled, <cite>portGET_RUN_TIME_COUNTER_VALUE()</cite> is called to get a high resolution timer counter value.</p></li>
<li><p>In PDK FreeRTOS porting layer, we implement <cite>portGET_RUN_TIME_COUNTER_VALUE()</cite> using PMU Counter for R5F and Time Stamp Counter for C66x to return time stamp in units of usecs</p></li>
<li><p>In FreeRTOS Kernel, the load measurement counter will overflow after 32b, i.e around 1 hr with usec resolution timer.</p></li>
<li><p>To avoid this, in FreeRTOS OSAL, a periodic load update API is called in IDLE task to accumulate the measured task load and take care of overflow condition.</p></li>
<li><p>To get task load with overflow condition taken care of, it is recommended to create the task using OSAL TaskP APIs</p></li>
<li><p>Total CPU load is calculated by measuring the time spent in IDLE task and then subtracting it from 100%, i.e CPU load = 100 - CPU idle load</p></li>
</ul>
</section>
<section id="task-fpu-context">
<span id="freertos-task-fpu-context"></span><h4><span class="section-number">9.1.3.1.4. </span>Task FPU context<a class="headerlink" href="#task-fpu-context" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>When <cite>configFLOATING_POINT_CONTEXT</cite> is enabled, save/restore of R5F FPU Registers will be performed during each task switch.</p></li>
<li><p>In this case all tasks are created with floating point context and usage of portTASK_USES_FLOATING_POINT/vPortTaskUsesFPU() doesn’t have any effect.</p></li>
<li><p><strong>PDK default</strong> is <cite>configFLOATING_POINT_CONTEXT</cite> enabled (when <cite>configOPTIMIZE_FOR_LATENCY</cite> is <cite>0</cite>).</p>
<ul>
<li><p>This matches the SYSBIOS implementation.</p></li>
<li><p>FreeRTOS C66x port as well save/restore the FPU registers by default.</p></li>
<li><p>C7x doesn’t have separate set of FPU registers.</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>For optimized performance the config can be disabled.</p>
<ul>
<li><p>In this case all task will start without a floating point context.</p></li>
<li><p>A task that uses the floating point hardware must call portTASK_USES_FLOATING_POINT/vPortTaskUsesFPU() before executing any floating point instructions.</p></li>
</ul>
</li>
</ul>
</section>
<section id="important-tips">
<h4><span class="section-number">9.1.3.1.5. </span>Important tips<a class="headerlink" href="#important-tips" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Task function should not return in FreeRTOS, instead, it should call vTaskDelete(NULL) to destroy itself, e.g</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">myTaskMain</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* ... do something ... */</span>

<span class="w">    </span><span class="n">vTaskDelete</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* do not call “return” */</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>On task delete, FreeRTOS will free any memory allocated internally, if dynamically memory allocation mode was used.
This memory free is done in the “IDLE” task, so “IDLE” needs to get the opportunity to run at some point.</p></li>
<li><p><cite>vTaskStartScheduler()</cite> starts FreeRTOS and the highest priority task is executed first.</p>
<ul class="simple">
<li><p>Tasks, semaphores and OS objects can be created before <cite>vTaskStartScheduler()</cite> is called.</p></li>
<li><p>Recommend to create one task and call <cite>vTaskStartScheduler()</cite>. Then do everything from within that task including creating other tasks.</p></li>
<li><p><strong>`vTaskStartScheduler()` is similar to `BIOS_start()`, i.e it never returns and switches to the created tasks or idle task</strong></p></li>
<li><p>.stack is the stack used by code before FreeRTOS scheduler is started, i.e from <cite>_c_int00</cite> to <cite>vTaskStartSchedular()</cite></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="freertos-interrupts">
<h3><span class="section-number">9.1.3.2. </span>FreeRTOS Interrupts<a class="headerlink" href="#freertos-interrupts" title="Permalink to this headline">¶</a></h3>
<section id="overview-1">
<h4><span class="section-number">9.1.3.2.1. </span>Overview<a class="headerlink" href="#overview-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Interrupt handler is not directly invoked by FreeRTOS Kernel, porting layer handles this</p>
<ul>
<li><p>In theory, FreeRTOS can work without interrupts. To switch tasks, interrupts are not needed. However, that’s not very useful.</p></li>
</ul>
</li>
<li><p>Porting layer does below</p>
<ul>
<li><p>Setup (any) one timer to be configured at <cite>configTICK_RATE_HZ</cite>, typically 1ms</p></li>
<li><p>For R5F, we use one of the SOC level general-purpose DM timers.</p></li>
<li><p>Timer ISR is outside FreeRTOS kernel</p></li>
<li><p>When the timer ISR happens the porting layer calls <cite>xTaskIncrementTick()</cite> FreeRTOS API to maintain the FreeRTOS timer tick state</p></li>
</ul>
</li>
<li><p>Porting layer also implements the common interrupt entry and exit logic</p>
<ul>
<li><p>Esp before interrupt exit, porting layer needs to invoke a task switch if during ISR handling
a semaphore was posted that needed a task switch on ISR exit</p></li>
</ul>
</li>
<li><p>Interrupt nesting is also taken care of by this common interrupt handler</p></li>
<li><p>Porting layer also implements functions to protect the critical sections of FreeRTOS via the below APIs</p>
<ul>
<li><p><cite>portENTER_CRITICAL</cite>, disable interrupt, track nesting of calls</p></li>
<li><p><cite>portEXIT_CRITICAL</cite>, re-enable interrupt, if nesting call depth is 0</p></li>
<li><p><cite>portSET_INTERRUPT_MASK_FROM_ISR</cite>, interrupt disable and return old interrupt state</p></li>
<li><p><cite>portCLEAR_INTERRUPT_MASK_FROM_ISR</cite>, restore interrupt state</p></li>
</ul>
</li>
</ul>
</section>
<section id="nested-interrupts-and-isr-stack">
<h4><span class="section-number">9.1.3.2.2. </span>Nested interrupts and ISR stack<a class="headerlink" href="#nested-interrupts-and-isr-stack" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>On R5F,</p>
<ul class="simple">
<li><p>When an interrupt is triggered, the CPU switches to IRQ mode and uses the IRQ stack.</p></li>
<li><p>IRQ interrupts are disabled by HW at this point.</p></li>
<li><p>In the ISR handler, some CPU state is saved to IRQ stack and mode is switched to SVC mode and therefore SVC stack</p></li>
<li><p>IRQs are then enabled, i.e nested interrupts are enabled</p></li>
<li><p>The user ISR code is executed</p></li>
<li><p>At this point, more IRQs can occur to interrupt the user ISR code</p></li>
<li><p>After all IRQs are handled, IRQ is disabled</p></li>
<li><p>Now mode is switched back to IRQ mode</p></li>
<li><p>If a task switch was requested by any of the ISRs, tasks are switched, and control returns from IRQ to the highest priority pending task</p></li>
<li><p>If a task switch was NOT requested, control returns from IRQ to the interrupted task</p></li>
</ul>
</li>
<li><p>On R5F,</p>
<ul>
<li><p>Thus the user ISR code gets called with SVC stack, so the size of the SVC stack MUST be kept large enough to handle worst-case ISR requirement.</p></li>
<li><p>The IRQ stack size itself can be kept small since it only saves few bytes (8 bytes) of state for every nested IRQ invocation.</p></li>
<li><p>This stack size is specified in the linker command file, a sample snippet is shown below,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">__IRQ_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w"> </span><span class="cm">/* This is the size of stack when R5 is in IRQ mode */</span>
<span class="n">__FIQ_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">__SVC_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span><span class="w"> </span><span class="cm">/* This is the size of stack when R5 is in SVC mode */</span>
<span class="n">__ABORT_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w">  </span><span class="cm">/* This is the size of stack when R5 is in ABORT mode */</span>
<span class="n">__UNDEFINED_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w">  </span><span class="cm">/* This is the size of stack when R5 is in UNDEF mode */</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="interrupts-outside-of-freertos">
<h4><span class="section-number">9.1.3.2.3. </span>Interrupts outside of FreeRTOS<a class="headerlink" href="#interrupts-outside-of-freertos" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>On R5F,</p>
<ul>
<li><p>When FreeRTOS enter its critical section, it only disables IRQ but not FIQ</p></li>
<li><p>Hence, FreeRTOS API calls MUST NOT be done inside FIQ.</p></li>
<li><p>FIQs can be used for extremely low latency interrupt bypassing the OS completely.</p></li>
<li><p><strong>NOTE: this is same as the case with SysBIOS</strong></p></li>
</ul>
</li>
</ul>
</section>
<section id="additional-important-tips">
<h4><span class="section-number">9.1.3.2.4. </span>Additional important tips<a class="headerlink" href="#additional-important-tips" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Only FreeRTOS APIs that end with <cite>FromISR</cite> can be called from the ISR context</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">BaseType_t</span><span class="w"> </span><span class="n">xHigherPriorityTaskWoken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="n">xSemaphoreGiveFromISR</span><span class="p">(</span><span class="n">pSemaphore</span><span class="o">-&gt;</span><span class="n">semHndl</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xHigherPriorityTaskWoken</span><span class="p">);</span>
<span class="n">portYIELD_FROM_ISR</span><span class="p">(</span><span class="n">xHigherPriorityTaskWoken</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>The <cite>FromISR</cite> API returns a flag <cite>xHigherPriorityTaskWoken</cite> to indicate task switch should be requested,
<cite>portYIELD_FROM_ISR</cite> requests the task switch. The actual task switch happens after all nested ISRs have been executed.</p></li>
<li><p><strong>This is different from SysBIOS, where the same APIs can be used inside ISR and outside ISR.</strong></p></li>
<li><p>The OSAL APIs will take care of this internally as below, e.g,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SemaphoreP_post</span><span class="p">(...)</span>
<span class="p">{</span>
<span class="w">  </span><span class="p">....</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">xPortInIsrContext</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="n">BaseType_t</span><span class="w"> </span><span class="n">xHigherPriorityTaskWoken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">      </span><span class="n">xSemaphoreGiveFromISR</span><span class="p">(</span><span class="n">pSemaphore</span><span class="o">-&gt;</span><span class="n">semHndl</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xHigherPriorityTaskWoken</span><span class="p">);</span>
<span class="w">      </span><span class="n">portYIELD_FROM_ISR</span><span class="p">(</span><span class="n">xHigherPriorityTaskWoken</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="n">xSemaphoreGive</span><span class="p">(</span><span class="n">pSemaphore</span><span class="o">-&gt;</span><span class="n">semHndl</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="freertos-semaphores-and-mutex">
<h3><span class="section-number">9.1.3.3. </span>FreeRTOS Semaphores and Mutex<a class="headerlink" href="#freertos-semaphores-and-mutex" title="Permalink to this headline">¶</a></h3>
<section id="overview-2">
<h4><span class="section-number">9.1.3.3.1. </span>Overview<a class="headerlink" href="#overview-2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS has a textbook implementation of binary semaphore, counting semaphore, mutex with priority inheritance,
and recursive mutex</p></li>
<li><p>Timeouts can be specified when waiting on a semaphore/mutex, with timeout error code if semaphore/mutex is not available</p></li>
<li><p>Timeout is specified in units of OS ticks. Use <cite>pdMS_TO_TICKS()</cite> to convert from msec to OS ticks</p></li>
</ul>
</section>
<section id="important-tips-1">
<h4><span class="section-number">9.1.3.3.2. </span>Important tips<a class="headerlink" href="#important-tips-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Binary and counting semaphores should be used to signal from ISR to task and task to task</p>
<ul>
<li><p><strong>PDK default config enables binary and counting semaphores</strong></p></li>
</ul>
</li>
<li><p>Mutex should be used for mutual exclusion of critical sections.</p>
<ul>
<li><p><strong>PDK default config enables mutex and recursive mutexes</strong></p></li>
</ul>
</li>
<li><p>Once again, only APIs that end with <cite>FromISR</cite> can be used from within ISR. These are non-blocking APIs.</p></li>
</ul>
</section>
</section>
<section id="freertos-task-notification">
<h3><span class="section-number">9.1.3.4. </span>FreeRTOS Task Notification<a class="headerlink" href="#freertos-task-notification" title="Permalink to this headline">¶</a></h3>
<section id="overview-3">
<h4><span class="section-number">9.1.3.4.1. </span>Overview<a class="headerlink" href="#overview-3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Task notification is low overhead API to signal a task from ISR or another task</p></li>
<li><p>We see about a 25% reduction in cycles needed for task switch using task notification vs using semaphores in ideal standalone conditions.</p></li>
<li><p>This is a very freertos specific API and PDK drivers and OSAL will NOT use this.</p></li>
</ul>
</section>
<section id="important-tips-2">
<h4><span class="section-number">9.1.3.4.2. </span>Important tips<a class="headerlink" href="#important-tips-2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>In practical use-cases, typically cache effects due to cache miss on the larger application code/data, will have a higher effect than
overheads of task switch in the smaller OS code.</p></li>
<li><p>So we recommend to NOT use this feature unless really the savings is critical to the end application.</p></li>
<li><p>Here one needs to know the task handle to signal, so it’s difficult to use this API from within a driver library since driver ISR for
example does not know the task in which the driver API is called</p></li>
<li><p>Thus use these APIs in applications after thorough analysis and profiling on benefit for the use-case.</p></li>
</ul>
</section>
</section>
<section id="freertos-event-groups">
<h3><span class="section-number">9.1.3.5. </span>FreeRTOS Event Groups<a class="headerlink" href="#freertos-event-groups" title="Permalink to this headline">¶</a></h3>
<section id="overview-4">
<h4><span class="section-number">9.1.3.5.1. </span>Overview<a class="headerlink" href="#overview-4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>An event group is a set of event bits. Event bits are used to indicate if an event has occurred or not. Event bits are often referred to as event flags.</p></li>
<li><p>The number of bits (or flags) stored within an event group is 24 bits</p></li>
</ul>
</section>
<section id="important-tips-for-application-writers">
<h4><span class="section-number">9.1.3.5.2. </span>Important tips for application writers<a class="headerlink" href="#important-tips-for-application-writers" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Unlike “Event” in SysBIOS where one could give a “AND” mask and “OR” mask to wait on, in FreeRTOS one can only give one “event mask” and then tell if one
should use “AND” wait or “OR” wait on the single event mask</p></li>
<li><p>When “set bits” is called from ISR, actual action of setting bits is done within the “Timer task” as a “deferred” function call.</p></li>
</ul>
</section>
</section>
<section id="freertos-timers">
<h3><span class="section-number">9.1.3.6. </span>FreeRTOS Timers<a class="headerlink" href="#freertos-timers" title="Permalink to this headline">¶</a></h3>
<section id="overview-5">
<h4><span class="section-number">9.1.3.6.1. </span>Overview<a class="headerlink" href="#overview-5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Allows users to create one-shot or periodic callbacks at timer resolution of one OS tick, typically 1ms.</p></li>
<li><p><strong>Similar to “Clock” module in SysBIOS</strong></p></li>
<li><p>A timer task executes the callbacks. This timer task is like any other task,  nothing special about it.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><strong>PDK default is to set highest priority for this task so that after all ISRs this task will execute</strong></p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>A SW queue is used to post callbacks or functions to execute on timer expiry, the queue depth is the config option.
<strong>PDK default is 16</strong></p></li>
</ul>
</section>
<section id="important-tips-3">
<h4><span class="section-number">9.1.3.6.2. </span>Important tips<a class="headerlink" href="#important-tips-3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Since a single task executes all the multiple callbacks, the callbacks are recommended to not block and spend too much time,
even though in theory blocking calls are allowed.</p></li>
<li><p>Use <cite>xTimerPendFunctionCall()</cite> to do “deferred ISR” handling, i.e do the most critical work in ISR and do the rest of the work in another
function call which gets called right after all ISRs are done. <strong>This feature can be used as alternative to SWI in SysBIOS</strong></p></li>
<li><p>Note, do not use <cite>FromISR</cite> APIs in callbacks, use regular FreeRTOS APIs</p></li>
</ul>
</section>
</section>
<section id="freertos-heaps">
<h3><span class="section-number">9.1.3.7. </span>FreeRTOS Heaps<a class="headerlink" href="#freertos-heaps" title="Permalink to this headline">¶</a></h3>
<section id="default-heap">
<h4><span class="section-number">9.1.3.7.1. </span>Default heap<a class="headerlink" href="#default-heap" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS kernel has multiple heap implementations as defined in <cite>portable/MemMang</cite></p></li>
<li><p>A port should compile one of the below <cite>heap_{n}.c</cite> files to pick the required heap implementation</p>
<ul>
<li><p><cite>heap_1.c</cite></p>
<ul>
<li><p>linear heap allocation, <cite>free()</cite> not allowed. Typically used when true dynamic alloc is prohibited.</p></li>
<li><p>Obsolete now and not used anymore, since FreeRTOS natively support static alloc mode</p></li>
</ul>
</li>
<li><p><cite>heap_2.c</cite></p>
<ul>
<li><p>Linked list based heap but adjacent free blocks not merged</p></li>
<li><p>Obsolete now and not used anymore, <cite>heap_4.c</cite> is a better implementation</p></li>
</ul>
</li>
<li><p><cite>heap_3.c</cite></p>
<ul>
<li><p>Uses compiler provided, <cite>malloc()</cite> and <cite>free()</cite>, FreeRTOS only makes the calls thread-safe</p></li>
<li><p>Heap size specified via <cite>–heap</cite> compiler option and placed in <cite>.heap</cite> section in the linker command file.</p></li>
</ul>
</li>
<li><p><cite>heap_4.c</cite> <strong>PDK default</strong></p>
<ul>
<li><p>Linked list based heap with adjacent free block merging</p></li>
<li><p>More or less similar to <cite>malloc()</cite> from compiler and SysBIOS heap implementation</p></li>
<li><p>Memory needs to be provided as a global static array, and placed appropriately in the linker command file.</p></li>
</ul>
</li>
<li><p><cite>heap_5.c</cite></p>
<ul>
<li><p>Same as <cite>heap_4.c</cite>, + it allows memory to be specified as multiple memory blocks
When memory in one block is full, it will alloc from the next block and so on.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="user-defined-heaps">
<h4><span class="section-number">9.1.3.7.2. </span>User defined heaps<a class="headerlink" href="#user-defined-heaps" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><strong>Unlike SysBIOS, FreeRTOS does not support user defined heaps at arbitrary user defined memory locations</strong></p></li>
<li><p>On TI SOCs with multiple levels of memory like L2, L3, DDR,
it is very convenient to have ability to create multiple application specified heaps.</p></li>
<li><p><cite>heap_4.c</cite> almost does this, but it uses a global variable for heap memory base and size</p></li>
<li><p>Therefore, PDK OSAL implements heap APIs to match SysBIOS as below</p>
<ul>
<li><p>PDK has adapted <cite>heap_4.c</cite> to take memory base and size as input parameters during heap create.
This allows creation of arbitrary number of application heaps to match SysBIOS features</p></li>
</ul>
</li>
<li><p><cite>HeapP.h</cite> is the user API</p></li>
<li><p><cite>HeapP_freertos.c</cite>, <cite>HeapP_freertos_internal.c</cite> is the implementation (Note, FreeRTOS kernel code is not modified)</p></li>
</ul>
</section>
<section id="important-tips-4">
<h4><span class="section-number">9.1.3.7.3. </span>Important tips<a class="headerlink" href="#important-tips-4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Use <cite>–heap</cite> in linker command file to specify heap size and place <cite>.heap</cite> section appropriate memory
in the linker command file. This is used by FreeRTOS(<cite>heap_4.c</cite>) when it needs dynamic memory allocation.</p></li>
<li><p>In general recommend to use FreeRTOS static alloc APIs for tasks, semaphores to keep the application deterministic.</p>
<ul>
<li><p>PDK OSAL uses FreeRTOS static alloc APIs</p></li>
</ul>
</li>
<li><p>Use PDK provided <cite>HeapP.h</cite> to create arbitrary application heaps as needed.</p></li>
</ul>
</section>
</section>
<section id="freertos-additional-modules">
<h3><span class="section-number">9.1.3.8. </span>FreeRTOS Additional Modules<a class="headerlink" href="#freertos-additional-modules" title="Permalink to this headline">¶</a></h3>
<section id="queues">
<h4><span class="section-number">9.1.3.8.1. </span>Queues<a class="headerlink" href="#queues" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Highly efficient SW queue implementation</p></li>
<li><p>Lowest level primitive in FreeRTOS used internally by almost all modules like tasks, semaphores, mutex</p></li>
<li><p>Thread/ISR safe</p></li>
<li><p>Blocking/non-blocking with timeouts</p></li>
<li><p>Fixed queue depth and fixed queue element size at queue create</p></li>
<li><p>Can be used by application users</p></li>
</ul>
</section>
<section id="queue-sets-event-groups-stream-buffers-co-routines">
<h4><span class="section-number">9.1.3.8.2. </span>Queue Sets, Event Groups, Stream Buffers, Co-routines<a class="headerlink" href="#queue-sets-event-groups-stream-buffers-co-routines" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Croutines, used when tasks are deemed too expensive to use, almost unlikely we will ever use these</p></li>
<li><p>Queue Sets, more higher level than queues, built using queues, semaphores. FreeRTOS recommends to use these very carefully. <a class="reference external" href="https://www.freertos.org/Pend-on-multiple-rtos-objects.html">https://www.freertos.org/Pend-on-multiple-rtos-objects.html</a></p></li>
<li><p>Stream buffers, built using queues, semaphores</p></li>
<li><p><strong>PDK default config keeps these disabled</strong></p></li>
</ul>
</section>
</section>
<section id="freertos-hook-functions">
<h3><span class="section-number">9.1.3.9. </span>FreeRTOS Hook Functions<a class="headerlink" href="#freertos-hook-functions" title="Permalink to this headline">¶</a></h3>
<section id="debug-hook-functions">
<h4><span class="section-number">9.1.3.9.1. </span>Debug Hook Functions<a class="headerlink" href="#debug-hook-functions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS provides “hook” function callbacks specified in FreeRTOS config.</p></li>
<li><p>These callbacks are invoked by FreeRTOS at specific points or when certain conditions are met</p></li>
<li><p>Stack overflow check, <cite>configCHECK_FOR_STACK_OVERFLOW</cite> <strong>PDK default enabled</strong></p>
<ul>
<li><p>Enables stack overflow checks, two options to detect overflows,</p>
<ul>
<li><p>Option 1: Check if the stack pointer has gone beyond the limit</p></li>
<li><p>Option 2: Put a pattern at top of the stack and if the pattern is overwritten then call out stack overflow  <strong>PDK default</strong></p></li>
<li><p><strong>NOTE:</strong> Depending on the nature of stack overflow, this logic may or may not catch all stack overflows</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Malloc failed hook, <cite>configUSE_MALLOC_FAILED_HOOK</cite> <strong>PDK default disabled</strong></p>
<ul>
<li><p>Called when <cite>pvPortMalloc</cite> fails inside FreeRTOS, not very useful, since all APIs return error on memory alloc failure.</p></li>
</ul>
</li>
<li><p>Assert, <cite>configASSERT</cite> <strong>PDK default enabled</strong></p>
<ul>
<li><p>Called when unrecoverable assert condition happens inside FreeRTOS or porting layer</p></li>
</ul>
</li>
<li><p>PDK defines a new config flag <cite>configOPTIMIZE_FOR_LATENCY</cite>, this can be used to disable all debug hooks and some other configs in FreeRTOS config to minimize FreeRTOS overheads due to debug hooks,</p></li>
<li><p>Recommend to enable all hooks in <cite>debug</cite> mode and disable all hooks in <cite>release</cite> mode after applications are reasonably sure assert and overflows will not happen.</p>
<ul>
<li><p>By default <cite>configOPTIMIZE_FOR_LATENCY</cite> is set to 0, i.e disabled</p></li>
</ul>
</li>
</ul>
</section>
<section id="statistics-hook-functions">
<h4><span class="section-number">9.1.3.9.2. </span>Statistics Hook Functions<a class="headerlink" href="#statistics-hook-functions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS provides APIs to query and return time spent in each task and output the results in a nice formatted table</p></li>
<li><p>The hook functions for this feature are enabled in <strong>PDK default config</strong> when <cite>configOPTIMIZE_FOR_LATENCY</cite> is 0.</p></li>
<li><p>It uses the same timer as the tick timer to measure task load.</p></li>
<li><p>See also <a class="reference external" href="https://www.freertos.org/rtos-run-time-stats.html">https://www.freertos.org/rtos-run-time-stats.html</a></p></li>
</ul>
</section>
<section id="trace-hooks-functions">
<h4><span class="section-number">9.1.3.9.3. </span>Trace Hooks Functions<a class="headerlink" href="#trace-hooks-functions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>FreeRTOS provides more than 70+ hook macros at key points in the kernel to log trace info</p></li>
<li><p>Example,</p>
<ul>
<li><p><cite>traceTASK_SWITCHED_IN</cite>, called when a task is being switched into</p></li>
<li><p><cite>traceTASK_SWITCHED_OUT</cite>, called when a task is being switched to another task</p></li>
</ul>
</li>
<li><p>This is used by tools like <cite>Tracealyzer</cite> to log and then visualize task execution and a lot more in a GUI tool, see <a class="reference external" href="https://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_Trace/FreeRTOS_Plus_Trace.html">https://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_Trace/FreeRTOS_Plus_Trace.html</a></p></li>
<li><p><strong>Not enabled in PDK default config</strong></p></li>
</ul>
</section>
</section>
</section>
<section id="freertos-migration-guidelines-1">
<span id="freertos-migration-guidelines"></span><h2><span class="section-number">9.1.4. </span>FreeRTOS Migration Guidelines<a class="headerlink" href="#freertos-migration-guidelines-1" title="Permalink to this headline">¶</a></h2>
<section id="porting-of-source-files">
<h3><span class="section-number">9.1.4.1. </span>Porting of source files<a class="headerlink" href="#porting-of-source-files" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Replace all SysBIOS API’s with OSAL API’s / FreeRTOS API’s</p></li>
<li><p>Remove SysBIOS Header files and include the OSAL /FreeRTOS headers</p></li>
<li><p>Recommend to add <cite>OS_init()</cite> before any other OS calls (like Task creation, Schedular Start, etc. )</p></li>
<li><p>Update “Task Function” to take input params of type <cite>void *</cite> (or pointer to a specific data type) instead of <cite>UArg</cite></p></li>
<li><p>Replace <cite>Void</cite> with <cite>void</cite></p></li>
<li><p>With usage of FreeRTOS Static API / OSAL API for Task Creation, application should pass the stack memory.
For example,</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define APP_TSK_STACK_MAIN (16U * 1024U)</span>
<span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">gAppTskStackMain</span><span class="p">[</span><span class="n">APP_TSK_STACK_MAIN</span><span class="p">]</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">32</span><span class="p">)));</span>

<span class="n">TaskP_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">);</span>
<span class="n">taskParams</span><span class="p">.</span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gAppTskStackMain</span><span class="p">;</span>
<span class="n">taskParams</span><span class="p">.</span><span class="n">stacksize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">gAppTskStackMain</span><span class="p">);</span>
<span class="n">taskHndl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskP_create</span><span class="p">(</span><span class="n">mainTask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>With usage of FreeRTOS Static API / OSAL API for Mailbox Creation, application should pass the mailbox buffer memory.
For example,</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">App_MailboxObj_s</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* Mailbox Object */</span>
<span class="p">}</span><span class="w"> </span><span class="n">App_MailboxObj</span><span class="p">;</span>

<span class="cp">#define APP_MBOX_MSG_CNT (10U)</span>

<span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">gAppMbxBuf</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">App_MailboxObj</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">APP_MBOX_MSG_CNT</span><span class="p">]</span><span class="w"> </span><span class="n">__attribute__</span><span class="w"> </span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">32</span><span class="p">)));</span>

<span class="n">MailboxP_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mboxParams</span><span class="p">);</span>
<span class="n">mboxParams</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">sizeof</span><span class="p">(</span><span class="n">App_MailboxObj</span><span class="p">);</span>
<span class="n">mboxParams</span><span class="p">.</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_MBOX_MSG_CNT</span><span class="p">;</span>
<span class="n">mboxParams</span><span class="p">.</span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gAppMbxBuf</span><span class="p">;</span>
<span class="n">mboxParams</span><span class="p">.</span><span class="n">bufsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gAppMbxBuf</span><span class="p">);</span>
<span class="n">mboxHndl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MailboxP_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mboxParams</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>See <a class="reference internal" href="#freertos-sysbios-osal-api-comparison"><span class="std std-ref">API Comparison</span></a> for detailed comparison of commonly used SysBIOS API’s vs equivalent FreeRTOS and OSAL APIs.</p>
</section>
<section id="building-with-freertos">
<span id="freertos-libs-inclusion"></span><h3><span class="section-number">9.1.4.2. </span>Building with FreeRTOS<a class="headerlink" href="#building-with-freertos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>To include PDK OSAL Library for FreeRTOS, use <cite>osal_freertos</cite> library.
This is in contrast to <cite>osal_tirtos</cite> - PDK OSAL Library for SysBIOS.</p></li>
</ul>
<ul class="simple">
<li><p>Include the following additional libraries</p>
<ul>
<li><p><cite>freertos</cite>    &lt;= Library including FreeRTOS Kernel and the Portable layer</p></li>
<li><p><cite>csl_intc</cite>    &lt;= [<strong>C66x Only</strong>]  CSL Library for C66x Interrupt Controller</p></li>
<li><p><cite>csl_init</cite>    &lt;= [<strong>R5F Only</strong>] CSL Library for C Startup, MPU/MMU Initialization, etc.</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<div class="line-block">
<div class="line">The above order is important. Library listing should always be from top of SW stack to bottom.</div>
<div class="line">For example, including <cite>csl_init</cite> before <cite>freertos</cite> may cause issues like application never reaches main.</div>
</div>
</aside>
</div></blockquote>
<ul>
<li><p>For FreeRTOS Build, include <cite>freertos</cite> as external components/interfaces, in place of <cite>bios</cite> and <cite>xdc</cite> used with SysBIOS
For example,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp"># List all the external components/interfaces, whose interface header files</span>
<span class="cp">#  need to be included for this component</span>
<span class="n">INCLUDE_EXTERNAL_INTERFACES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pdk</span>

<span class="n">ifeq</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">(</span><span class="n">BUILD_OS_TYPE</span><span class="p">),</span><span class="w"> </span><span class="n">freertos</span><span class="p">)</span>
<span class="w">  </span><span class="n">INCLUDE_EXTERNAL_INTERFACES</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">freertos</span>
<span class="n">endif</span>
<span class="n">ifeq</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">(</span><span class="n">BUILD_OS_TYPE</span><span class="p">),</span><span class="w"> </span><span class="n">tirtos</span><span class="p">)</span>
<span class="w">  </span><span class="n">INCLUDE_EXTERNAL_INTERFACES</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">xdc</span><span class="w"> </span><span class="n">bios</span>
<span class="n">endif</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="linker-file-for-freertos">
<h3><span class="section-number">9.1.4.3. </span>Linker file for FreeRTOS<a class="headerlink" href="#linker-file-for-freertos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The default linker file for FreeRTOS Build (<cite>linker_${ISA}_freertos.lds</cite>) is preset at ${PDK_INSTALL_DIR}/packages/ti/build/j721e</p></li>
</ul>
<section id="important-tips-5">
<h4><span class="section-number">9.1.4.3.1. </span>Important tips<a class="headerlink" href="#important-tips-5" title="Permalink to this headline">¶</a></h4>
<p>On R5F, Following are major updates required for creating a custom linker files for FreeRTOS Build compared to that for SysBIOS</p>
<ul>
<li><p>Include the following Linker Settings</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.bootCode)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.startupCode)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.startupData)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.irqStack)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.fiqStack)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.abortStack)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.undStack)&quot;</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.svcStack)&quot;</span>

<span class="o">--</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span>
<span class="o">--</span><span class="n">stack_size</span><span class="o">=</span><span class="mh">0x4000</span>
<span class="o">--</span><span class="n">heap_size</span><span class="o">=</span><span class="mh">0x8000</span>
<span class="o">--</span><span class="n">entry_point</span><span class="o">=</span><span class="n">_freertosresetvectors</span>

<span class="o">-</span><span class="n">stack</span><span class="w">  </span><span class="mh">0x4000</span><span class="w">  </span><span class="cm">/* SOFTWARE STACK SIZE */</span>
<span class="o">-</span><span class="n">heap</span><span class="w">   </span><span class="mh">0x8000</span><span class="w">  </span><span class="cm">/* HEAP AREA SIZE      */</span>

<span class="cm">/*-------------------------------------------*/</span>
<span class="cm">/*       Stack Sizes for various modes       */</span>
<span class="cm">/*-------------------------------------------*/</span>
<span class="n">__IRQ_STACK_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">;</span>
<span class="n">__FIQ_STACK_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="n">__ABORT_STACK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="n">__UND_STACK_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="n">__SVC_STACK_SIZE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p>The following linker settings used in case for SysBIOS is not required.</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">__VECS_ENTRY_POINT</span>
<span class="o">--</span><span class="n">retain</span><span class="o">=</span><span class="s">&quot;*(.utilsCopyVecsToAtcm)&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</aside>
<ul class="simple">
<li><p>The FreeRTOS default linker file places the reset vectors directly at <cite>0x0(ATCM)</cite>.</p></li>
<li><p>In case of placing the reset vectors at some different address,  <cite>configCOPY_RESET_VECTORS</cite> in FreeROTSConfig.h should be enabled.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>When <cite>configCOPY_RESET_VECTORS</cite> is enabled, the reset vectors are copied to <cite>0x0</cite> during the schedular start.</p>
<ul>
<li><p>This is handled by the FreeRTOS portable layer.</p></li>
</ul>
</li>
<li><p>With SysBIOS, PDK <cite>utilsCopyVecsToAtcm</cite> was used for a similar scenario.</p></li>
<li><p>In case of SySBIOS, <cite>utilsCopyVecsToAtcm</cite> was used as XDC reset hook function. So the reset vectors will already by copied to <cite>0x0(ATCM)</cite> by the time it reaches <cite>main()</cite>.</p></li>
<li><p>On contrast with FreeRTOS, the portable layer handles the copy of reset vectors to <cite>0x0(ATCM)</cite> and this happens during the FreeRTOS schedular start from <cite>main()</cite>.</p></li>
</ul>
</aside>
</section>
</section>
<section id="mpu-cache-settings-in-freertos">
<span id="freertos-mpu-cache-settings"></span><h3><span class="section-number">9.1.4.4. </span>MPU/Cache Settings in FreeRTOS<a class="headerlink" href="#mpu-cache-settings-in-freertos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In FreeRTOS MPU/Cache Settings for various memory regions are configured via CSL API’s during the C/C++ startup routine (<cite>_c_int00()</cite>)</p>
<ul>
<li><p>The default settings (<cite>gCslR5MpuCfg</cite>) are defined in <cite>PDK_INSTALL_DIR/packages/ti/csl/arch/r5/src/startup/startup.c</cite></p></li>
</ul>
</li>
<li><p>This is unlike SysBIOS, in which the MPU/Cache settings were done using the XDC cfg file.</p></li>
</ul>
<section id="important-tips-for-creating-custom-mpu-cache-settings">
<h4><span class="section-number">9.1.4.4.1. </span>Important tips for creating Custom MPU/Cache Settings<a class="headerlink" href="#important-tips-for-creating-custom-mpu-cache-settings" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The default settings <cite>gCslR5MpuCfg</cite> defined in <cite>PDK_INSTALL_DIR/packages/ti/csl/arch/r5/src/startup/startup.c</cite> is a weak definition and
applications can override the defaults by simply redefining the same.</p></li>
<li><p>Typical use-cases may include adding a new section and/or modifying the default attributes of a memory region.</p></li>
<li><p>Applications may include a new source file which redefines the <cite>gCslR5MpuCfg</cite> as per the required configuration.</p></li>
</ul>
<section id="example">
<h5><span class="section-number">9.1.4.4.1.1. </span>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>The method described above is implemented for IPC example, to modify the Ring Buffer as non-cacheable.</p>
<ul class="simple">
<li><p>MPU Config File (<cite>r5f_mpu_${soc}_default.c</cite> at <cite>PDK_INSTALL_DIR/packages/ti/drv/ipc/examples/common/src</cite>)</p>
<ul>
<li><p>Re-defines <cite>CSL_ArmR5MpuRegionCfg gCslR5MpuCfg[CSL_ARM_R5F_MPU_REGIONS_MAX]</cite></p></li>
<li><p>This structure specifies the entries for mpu configuration to override the default MPU configuration which is part of the CSL init.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="exception-handling-in-freertos">
<h3><span class="section-number">9.1.4.5. </span>Exception handling in FreeRTOS<a class="headerlink" href="#exception-handling-in-freertos" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>For R5F, FreeRTOS in PDK currently only supports Data Abort Exception Callback.</p>
<ul class="simple">
<li><p>For other exceptions like Undefined Instruction, Pre-fetch Abort, it ends up in the default exception handler’s infinite while loop.</p></li>
</ul>
</li>
<li><p>To register Data Abort Exception Callback for FreeRTOS, use <cite>csl/arch/r5/interrupt.h - Intc_RegisterExptnHandlers</cite> API</p>
<ul>
<li><p>For example,</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/csl/arch/csl_arch.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">appDAbtExptnClbkFxn</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* Define callback function to be executed on</span>
<span class="cm">     * data abort exception */</span>
<span class="p">}</span>

<span class="cm">/* Register exception handler */</span>
<span class="n">CSL_R5ExptnHandlers</span><span class="w"> </span><span class="n">appR5ExptnHandlers</span><span class="p">;</span>
<span class="n">Intc_InitExptnHandlers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appR5ExptnHandlers</span><span class="p">);</span>
<span class="n">appR5ExptnHandlers</span><span class="p">.</span><span class="n">dabtExptnHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appDAbtExptnClbkFxn</span><span class="p">;</span>
<span class="n">Intc_RegisterExptnHandlers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appR5ExptnHandlers</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</li>
</ul>
<section id="important-tips-6">
<h4><span class="section-number">9.1.4.5.1. </span>Important tips<a class="headerlink" href="#important-tips-6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>In case of SysBIOS, this was setup via XDC cfg and it directly plug in the passed hook function to the reset vectors.</p></li>
<li><p>On contrast with FreeRTOS, the data abort exception ends up in a default exception handler and will in-turn redirect to callback function(if registered)</p>
<ul>
<li><p>As a result the callback function can be a normal function, i.e. it shouldn’t take care of returning from an interrupt, etc.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="reset-hook-function-alternative-for-freertos">
<span id="reset-hook-alternative-for-freertos"></span><h3><span class="section-number">9.1.4.6. </span>Reset Hook Function Alternative for FreeRTOS<a class="headerlink" href="#reset-hook-function-alternative-for-freertos" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>SysBIOS supported reset hook functions (functions to call at reset), since the startup code was also part of XDC(BIOS).</p></li>
<li><dl class="simple">
<dt>In case fo FreeRTOS, the startup code is not part of FreeRTOS Kernel and hence reset hooks functions are not supported.</dt><dd><ul class="simple">
<li><p>Here startup code is part of CSL Init.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>As an alternative to reset hook functions, applications can redefine the CSL Startup API <cite>_system_post_cinit</cite> to achieve similar functionality.</dt><dd><ul class="simple">
<li><p><cite>_system_post_cinit()</cite> is a hook function called in the C/C++ auto-initialization function after <cite>cinit()</cite> and before <cite>pinit()</cite>.</p></li>
<li><p>FreeRTOS portable layer have a default weak definition for <cite>_system_post_cinit</cite> at ${PDK_INSTALL_PATH}/packages/ti/kernel/freertos/portable/TI_CGT/${ISA}/port.c</p></li>
<li><p>Application can redefine this in the source file to add the code to be executed on reset. For example,</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/csl/arch/csl_arch.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">_system_post_cinit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* Following is the default implementation in portable layer */</span>
<span class="w">    </span><span class="n">osalArch_Config_t</span><span class="w"> </span><span class="n">cfg</span><span class="p">;</span>

<span class="w">    </span><span class="n">cfg</span><span class="p">.</span><span class="n">disableIrqOnInit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">osalArch_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* --------------------------------------------------------*/</span>
<span class="w">    </span><span class="cm">/* Add here application specific code, to be done on reset */</span>
<span class="w">    </span><span class="cm">/* --------------------------------------------------------*/</span>

<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="api-comparison">
<span id="freertos-sysbios-osal-api-comparison"></span><h2><span class="section-number">9.1.5. </span>API Comparison<a class="headerlink" href="#api-comparison" title="Permalink to this headline">¶</a></h2>
<p>The following section compares commonly used SysBIOS API’s vs equivalent FreeRTOS and OSAL APIs.
For more detailed info on the same refer the individual API Guides.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.freertos.org/a00106.html">FreeRTOS API Reference</a></p></li>
<li><p><a class="reference external" href="https://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/bios/sysbios/6_83_00_18/exports/bios_6_83_00_18/docs/cdoc/index.html">SysBIOS API Documentation</a></p></li>
<li><p><a class="reference external" href="../../../apiguide/j721e/html/group__DRV__OSAL__MODULE.html">OSAL API Guide</a></p></li>
</ul>
<section id="scheduler-general">
<h3><span class="section-number">9.1.5.1. </span>Scheduler / General<a class="headerlink" href="#scheduler-general" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-NA-</p></td>
<td><p>-NA-</p></td>
<td><p>OS_init()</p></td>
<td><p>Recommend to add <cite>OS_init()</cite> before any other OS calls (like Task creation, Schedular Start, etc. )</p></td>
</tr>
<tr class="row-odd"><td><p>BIOS_start</p></td>
<td><p>vTaskStartScheduler()</p></td>
<td><p>OS_start()</p></td>
<td><p>Starts the Scheduler</p></td>
</tr>
<tr class="row-even"><td><p>BIOS_exit(0)</p></td>
<td><p>vTaskEndScheduler()</p></td>
<td><p>OS_stop()</p></td>
<td><p>Stops the Scheduler</p></td>
</tr>
<tr class="row-odd"><td><p>BIOS_WAIT_FOREVER</p></td>
<td><p>portMAX_DELAY</p></td>
<td><p>osal_WAIT_FOREVER</p></td>
<td><p>Macro for timeout wait forever</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tasks">
<h3><span class="section-number">9.1.5.2. </span>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Task_Params_init</p></td>
<td><p>-NA-</p></td>
<td><p>TaskP_Params_init</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Task_construct</p></td>
<td><p>xTaskCreateStatic</p></td>
<td><p>TaskP_create</p></td>
<td><ul class="simple">
<li><p>FreeRTOS only takes one argument to be passed to the Task Function.</p></li>
<li><p>SysBIOS had two arguments (arg0 and arg1)</p></li>
<li><p>OSAL Supports two arguments similar to SysBIOS,
and implements a wrapper for FreeRTOS to support this.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Task_destruct</p></td>
<td><p>vTaskDelete</p></td>
<td><p>TaskP_delete</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Task_sleep</p></td>
<td><p>vTaskDelay</p></td>
<td><p>TaskP_sleep</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Task_setPri</p></td>
<td><p>vTaskPrioritySet</p></td>
<td><p>TaskP_setPrio</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Task_self</p></td>
<td><p>xTaskGetCurrentTaskHandle</p></td>
<td><p>TaskP_self</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Task_yield</p></td>
<td><p>taskYIELD</p></td>
<td><p>Task_yield</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Task_getMode</p></td>
<td><p>eTaskGetState</p></td>
<td><p>TaskP_isTerminated</p></td>
<td><ul class="simple">
<li><p>OSAL API is only to check if the task is terminated or not</p></li>
<li><p>FreeRTOS/SysBIOS API returns the current state of the task</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Task_Handle</p></td>
<td><p>TaskHandle_t</p></td>
<td><p>TaskP_Handle</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Task_Params</p></td>
<td><p><cite>Arguments to create function</cite></p></td>
<td><p>TaskP_Params</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="semaphores">
<h3><span class="section-number">9.1.5.3. </span>Semaphores<a class="headerlink" href="#semaphores" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Semaphore_Params_init</p></td>
<td><p>-NA-</p></td>
<td><p>SemaphoreP_Params_init</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Semaphore_construct</p></td>
<td><p>xSemaphoreCreateBinaryStatic /
xSemaphoreCreateCountingStatic</p></td>
<td><p>SemaphoreP_create</p></td>
<td><ul class="simple">
<li><p>In SysBIOS same API was used to create Binary/Counting semaphore</p>
<ul>
<li><p>‘mode’ in ‘Semaphore_Params’ was used to specify this</p></li>
</ul>
</li>
<li><p>Two different APIs in case of FreeRTOS</p></li>
<li><p>OSAL API is similar to SysBIOS.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Semaphore_destruct</p></td>
<td><p>vSemaphoreDelete</p></td>
<td><p>SemaphoreP_delete</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Semaphore_pend</p></td>
<td><p>xSemaphoreTake /
xSemaphoreTakeFromISR</p></td>
<td><p>SemaphoreP_pend</p></td>
<td><ul>
<li><p>In case of FreeRTOS, timeout is ignored when in ISR mode</p></li>
<li><p>FreeRTOS FromISR API sets the return flag ‘pxHigherPriorityTaskWoken’
if calling the API function causes a task to leave the Blocked state,
and the unblocked task has a priority equal to or higher than the currently executing task</p>
<p>If so, a context switch should be requested before the interrupt is exited.</p>
</li>
<li><p>OSAL API handles this internally by invoking <cite>portYIELD_FROM_ISR</cite> with the return flag.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Semaphore_post</p></td>
<td><p>xSemaphoreGive /
xSemaphoreGiveFromISR</p></td>
<td><p>SemaphoreP_post</p></td>
<td><ul class="simple">
<li><p>FreeRTOS FromISR API sets the return flag ‘pxHigherPriorityTaskWoken’
if giving the semaphore caused a task to unblock,
and the unblocked task has a priority higher than the currently running task.
If so, a context switch should be requested before the interrupt is exited.</p></li>
<li><p>OSAL API handles this internally by invoking <cite>portYIELD_FROM_ISR</cite> with the return flag.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Semaphore_getCount</p></td>
<td><p>uxSemaphoreGetCount</p></td>
<td><p>SemaphoreP_getCount</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Semaphore_reset</p></td>
<td><p>-NA-</p></td>
<td><p>SemaphoreP_reset</p></td>
<td><ul class="simple">
<li><p>FreeRTOS doesn’t have an API to rest the semaphore count.</p></li>
<li><p>SysBIOS API supported passing the preferred count.</p></li>
<li><p>OSAL API only supports reset the count to zero.</p>
<ul>
<li><p>For FreeRTOS, the xSemaphoreTake API is repeatedly called until it returns timeout.</p></li>
<li><p>So the OSAL API shouldn’t be called from an ISR.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Semaphore_Handle</p></td>
<td><p>SemaphoreHandle_t</p></td>
<td><p>SemaphoreP_Handle</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Semaphore_Params</p></td>
<td><p><cite>Arguments to create function</cite></p></td>
<td><p>SemaphoreP_Params</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="mutex">
<h3><span class="section-number">9.1.5.4. </span>Mutex<a class="headerlink" href="#mutex" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GateMutexPri_construct</p></td>
<td><p>xSemaphoreCreateRecursiveMutexStatic</p></td>
<td><p>MutexP_create</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GateMutexPri_destruct</p></td>
<td><p>vSemaphoreDelete</p></td>
<td><p>MutexP_delete</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>GateMutexPri_enter</p></td>
<td><p>xSemaphoreTakeRecursive</p></td>
<td><p>MutexP_lock</p></td>
<td><ul class="simple">
<li><p>FreeRTOS API takes an i/p ‘xTicksToWait(timeout)’ to specify the time to wait.
A block time of zero can be used to poll.
If the task already owns the mutex then API will return immediately
no matter what the value of xTicksToWait.</p></li>
<li><p>OSAL API takes i/p param ‘timeout’ similar to FreeRTOS.</p></li>
<li><p>FreeRTOS / OSAL API does not return ‘key’.</p>
<ul>
<li><p>Note: OSAL API returns Status codes.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>GateMutexPri_leave</p></td>
<td><p>xSemaphoreGiveRecursive</p></td>
<td><p>MutexP_unlock</p></td>
<td><ul class="simple">
<li><p>No need to pass ‘key’ as an argument to FreeRTOS /  OSAL API.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>GateMutexPri_Handle</p></td>
<td><p>SemaphoreHandle_t</p></td>
<td><p>MutexP_Handle</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="software-timers">
<h3><span class="section-number">9.1.5.5. </span>Software Timers<a class="headerlink" href="#software-timers" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Clock_Params_init</p></td>
<td><p>-NA-</p></td>
<td><p>ClockP_Params_init</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Clock_construct</p></td>
<td><p>xTimerCreateStatic</p></td>
<td><p>ClockP_create</p></td>
<td><ul class="simple">
<li><p>SysBIOS have two params namely ‘period’ and ‘timeout’.</p>
<ul>
<li><p>‘period’ part of ‘Clock_Params’ :-
Period of the instance incase for Continuous timer</p></li>
<li><p>‘timeout’ passed as argument to ‘Clock_create’ :-
Period used for one-shot timer / for first run</p></li>
</ul>
</li>
<li><p>FreeRTOS timer create function takes an i/p flag ‘uxAutoReload’ and ‘xTimerPeriod’</p>
<ul>
<li><p>If ‘uxAutoReload’ is set, then timer will be in continuous mode.</p></li>
<li><p>If ‘uxAutoReload’ is not set, then the timer will be in one-shot mode.</p></li>
</ul>
</li>
<li><p>OSAL Clock Create API doesn’t take ‘timeout’ as an argument.</p>
<ul>
<li><p>Instead use ‘ClockP_Params’ ‘period’ and ‘runMode’.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Clock_destruct</p></td>
<td><p>xTimerDelete</p></td>
<td><p>ClockP_delete</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Clock_start</p></td>
<td><p>xTimerStart /
xTimerStartFromISR</p></td>
<td><p>ClockP_start</p></td>
<td><ul class="simple">
<li><p>FreeRTOS FromISR API sets the return flag ‘pxHigherPriorityTaskWoken’
if calling the API function causes the timer service/daemon task to leave
the Blocked state, and the timer service/ daemon task has a priority equal to
or greater than the currently executing task.
If so, a context switch should be requested before the interrupt is exited.</p></li>
<li><p>OSAL API handles this internally by invoking <cite>portYIELD_FROM_ISR</cite> with the
return flag.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Clock_stop</p></td>
<td><p>xTimerStop /
xTimerStopFromISR</p></td>
<td><p>ClockP_stop</p></td>
<td><ul class="simple">
<li><p>FreeRTOS FromISR API sets the return flag ‘pxHigherPriorityTaskWoken’
if calling the API function causes the timer service/daemon task to leave
the Blocked state, and the timer service/ daemon task has a priority equal to
or greater than the currently executing task.
If so, a context switch should be requested before the interrupt is exited.</p></li>
<li><p>OSAL API handles this internally by invoking <cite>portYIELD_FROM_ISR</cite> with the
return flag.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Clock_Handle</p></td>
<td><p>TimerHandle_t</p></td>
<td><p>ClockP_Handle</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Clock_Params</p></td>
<td><p><cite>Arguments to create function</cite></p></td>
<td><p>ClockP_Params</p></td>
<td><ul class="simple">
<li><p>FreeRTOS doesn’t support auto start with timer create.
Need to explicitly call start function.</p></li>
<li><p>‘startMode’ param in OSAL instead of ‘startFlag’ in SysBIOS</p>
<ul>
<li><p>ClockP_StartMode_USER (Default) (equivalent to startFlag=FALSE)</p></li>
<li><p>ClockP_StartMode_AUTO (equivalent to startFlag=TRUE)</p></li>
</ul>
</li>
<li><p>New param ‘runMode’ for OSAL API</p>
<ul>
<li><p>ClockP_RunMode_CONTINUOUS</p></li>
<li><p>ClockP_RunMode_ONESHOT (Default)</p></li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="events">
<h3><span class="section-number">9.1.5.6. </span>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Event_construct</p></td>
<td><p>xEventGroupCreateStatic</p></td>
<td><p>EventP_create</p></td>
<td><ul class="simple">
<li><p>For FreeRTOS, the no. of bits for an event is 24</p></li>
<li><p>For SysBIOS, the no. of bits for an event is 32.</p></li>
<li><p>OSAL also supports only upto 24 bits.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Event_destruct</p></td>
<td><p>vEventGroupDelete</p></td>
<td><p>EventP_delete</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Event_pend</p></td>
<td><p>xEventGroupWaitBits</p></td>
<td><p>EventP_wait</p></td>
<td><ul class="simple">
<li><p>SysBIOS Event_pend API takes two i.p masks to pend on:-</p>
<ol class="arabic simple">
<li><p>andMask</p></li>
<li><p>orMask</p></li>
</ol>
</li>
<li><p>FreeRTOS API takes only one i.p mask and a flag to specify AND/OR logic</p>
<ul>
<li><p>Not both masks together.</p></li>
</ul>
</li>
<li><p>OSAL API is similar to FreeRTOS</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Event_post</p></td>
<td><p>xEventGroupSetBits /
xEventGroupSetBitsFromISR</p></td>
<td><p>EventP_post</p></td>
<td><ul class="simple">
<li><p>In FreeRTOS , setting bits from an ISR will defer the set operation
to the RTOS daemon task (also known as the timer service task).
FreeRTOS FromISR API sets the return flag ‘pxHigherPriorityTaskWoken’
if the priority of the daemon task is higher than the priority of the
currently running task.
If so, a context switch should be requested before the interrupt is exited.</p></li>
<li><p>OSAL API handles this internally by invoking <cite>portYIELD_FROM_ISR</cite> with the return flag.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Event_getPostedEvents</p></td>
<td><p>xEventGroupGetBits /
xEventGroupGetBitsFromISR</p></td>
<td><p>EventP_getPostedEvents</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Event_Handle</p></td>
<td><p>EventGroupHandle_t</p></td>
<td><p>EventP_Handle</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="mailbox">
<h3><span class="section-number">9.1.5.7. </span>Mailbox<a class="headerlink" href="#mailbox" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Mailbox_Params_init</p></td>
<td><p>-NA-</p></td>
<td><p>MailboxP_Params_init</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Mailbox_construct</p></td>
<td><p>xQueueCreateStatic</p></td>
<td><p>MailboxP_create</p></td>
<td><ul class="simple">
<li><p>FreeRTOS API i/p params ‘uxQueueLength’ equivalent to SysBIOS ‘numMsgs’</p></li>
<li><p>FreeRTOS API i/p params ‘uxItemSize’ equivalent to SysBIOS ‘msgSize’</p></li>
<li><p>OSAL API doesn’t take ‘msgSize’ and ‘numMsgs’ as an argument.
Instead set ‘size’ and ‘count’ in MailboxP_Params</p></li>
<li><p>With FreeRTOS Static API, User should also pass ‘pucQueueStorageBuffer’ -
point to a uint8_t array that is at least large enough to hold the maximum
number of items that can be in the queue at any one time - which is
( uxQueueLength * uxItemSize ) bytes.</p></li>
<li><p>Same case with OSAL API. User should pass ‘buf’ and ‘bufSize’</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Mailbox_destruct</p></td>
<td><p>vQueueDelete</p></td>
<td><p>MailboxP_delete</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Mailbox_post</p></td>
<td><p>xQueueSendToBack /
xQueueSendToBackFromISR</p></td>
<td><p>MailboxP_post</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Mailbox_pend</p></td>
<td><p>xQueueReceive /
xQueueReceiveFromISR</p></td>
<td><p>MailboxP_pend</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Mailbox_getNumPendingMsgs</p></td>
<td><p>uxQueueMessagesWaiting /
uxQueueMessagesWaitingFromISR</p></td>
<td><p>MailboxP_getNumPendingMsgs</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Mailbox_Handle</p></td>
<td><p>QueueHandle_t</p></td>
<td><p>MailboxP_Handle</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Mailbox_Params</p></td>
<td><p><cite>Arguments to create function</cite></p></td>
<td><p>MailboxP_Params</p></td>
<td><dl class="simple">
<dt>New params in OSAL</dt><dd><ul class="simple">
<li><p>‘size’ - The size of message</p></li>
<li><p>‘count’ - maximum number of items the mailbox can hold at any one time</p></li>
<li><p>‘buf’ - pointer to mailbox buffer memory</p></li>
<li><p>‘bufsize’ - buffer size</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</section>
<section id="queue">
<h3><span class="section-number">9.1.5.8. </span>Queue<a class="headerlink" href="#queue" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>FreeRTOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Queue_construct</p></td>
<td><p>vListInitialise</p></td>
<td><p>QueueP_create</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Queue_destruct</p></td>
<td><p>-NA-</p></td>
<td><p>QueueP_delete</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Queue_get</p></td>
<td><p>listGET_HEAD_ENTRY</p></td>
<td><p>QueueP_get</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Queue_put</p></td>
<td><p>vListInsertEnd</p></td>
<td><p>QueueP_put</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Queue_empty</p></td>
<td><p>listLIST_IS_EMPTY</p></td>
<td><p>QueueP_isEmpty</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Queue_Handle</p></td>
<td><p>pxList</p></td>
<td><p>QueueP_Handle</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="arbitrary-heaps">
<h3><span class="section-number">9.1.5.9. </span>Arbitrary Heaps<a class="headerlink" href="#arbitrary-heaps" title="Permalink to this headline">¶</a></h3>
<p>FreeRTOS doesn’t support creating arbitrary heaps. The following table compares the SysBIOS HeapMem with the OSAL HeapP implementation.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HeapMem_Params_init</p></td>
<td><p>HeapP_Params_init</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>HeapMem_construct</p></td>
<td><p>HeapP_create</p></td>
<td><p>Takes only HeapP_Params as i/p param</p></td>
</tr>
<tr class="row-even"><td><p>HeapMem_destruct</p></td>
<td><p>HeapP_delete</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>HeapMem_alloc</p></td>
<td><p>HeapP_alloc</p></td>
<td><ul class="simple">
<li><p>OSAL API doesn’t take ‘align’ as an arg</p>
<ul>
<li><p>This is handled by the define <cite>HeapP_BYTE_ALIGNMENT</cite> in HeapP.h</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>HeapMem_free</p></td>
<td><p>HeapP_free</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>HeapMem_getStats</p></td>
<td><p>HeapP_getHeapStats</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>HeapMem_Struct</p></td>
<td><p>-NA-</p></td>
<td><p>Not required to pass the structure from application. OSAL internally handles this</p></td>
</tr>
<tr class="row-odd"><td><p>HeapMem_Params</p></td>
<td><p>HeapP_Params</p></td>
<td><ul class="simple">
<li><p>‘buf’ - Base address of memory to be used as heap</p></li>
<li><p>‘size’ - Size of memory block that is to be used as heap</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>HeapMem_Handle</p></td>
<td><p>HeapP_Handle</p></td>
<td><ul class="simple">
<li><p>OSAL doesn’t have ‘minBlockAlign’ as a param</p>
<ul>
<li><p>This is handled by the define <cite>HeapP_BYTE_ALIGNMENT</cite> in HeapP.h</p></li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="task-cpu-load">
<h3><span class="section-number">9.1.5.10. </span>Task / CPU Load<a class="headerlink" href="#task-cpu-load" title="Permalink to this headline">¶</a></h3>
<p>Refer FreeRTOS native Run-time stats APIs Documentation at <a class="reference external" href="https://www.freertos.org/rtos-run-time-stats.html">https://www.freertos.org/rtos-run-time-stats.html</a></p>
<p>Following table compares the SysBIOS Load module with the OSAL LoadP implementation for FreeRTOS.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>OSAL for FreeRTOS</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Load_Stat</p></td>
<td><p>LoadP_Stats</p></td>
<td><p>Structure with Load statistics info</p>
<ul class="simple">
<li><p>Name of the task [OSAL only]</p></li>
<li><p>Runtime for the task</p></li>
<li><p>Total Runtime</p></li>
<li><p>Percentage load of the task [OSAL only]</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Load_reset</p></td>
<td><p>LoadP_reset</p></td>
<td><p>Function to Reset load statistics</p>
<p>Until load statistics is reset the load statistics keep getting accumulated.</p>
</td>
</tr>
<tr class="row-even"><td><p>Load_getTaskLoad</p></td>
<td><p>LoadP_getTaskLoad</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Load_getCPULoad</p></td>
<td><p>LoadP_getCPULoad</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="cache-operations">
<h3><span class="section-number">9.1.5.11. </span>Cache Operations<a class="headerlink" href="#cache-operations" title="Permalink to this headline">¶</a></h3>
<p>Cache operations are not supported as part of FreeRTOS Kernel.</p>
<p>Following table compares the SysBIOS and OSAL Cache APIs.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>OSAL</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Cache_wb</p></td>
<td><p>CacheP_wb</p></td>
<td rowspan="3"><ul class="simple">
<li><p>SysBIOS supported asynchronous operation
by setting ‘wait’ flag to FALSE and
later using <cite>Cache_wait</cite> to wait for all
operations to conmplete.</p></li>
<li><p>This is not supported in OSAL .</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Cache_inv</p></td>
<td><p>CacheP_Inv</p></td>
</tr>
<tr class="row-even"><td><p>Cache_wbInv</p></td>
<td><p>CacheP_wbInv</p></td>
</tr>
</tbody>
</table>
</section>
<section id="hw-interrupts">
<h3><span class="section-number">9.1.5.12. </span>HW Interrupts<a class="headerlink" href="#hw-interrupts" title="Permalink to this headline">¶</a></h3>
<p>HW Interrupts are not supported as part of FreeRTOS Kernel.</p>
<p>Following table compares the SysBIOS and OSAL HW Interrupt APIs.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>OSAL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Hwi_Params_init</p></td>
<td><p>HwiP_Params_init</p></td>
</tr>
<tr class="row-odd"><td><p>Hwi_construct</p></td>
<td><p>HwiP_create</p></td>
</tr>
<tr class="row-even"><td><p>Hwi_destruct</p></td>
<td><p>HwiP_delete</p></td>
</tr>
<tr class="row-odd"><td><p>Hwi_disable</p></td>
<td><p>HwiP_disable</p></td>
</tr>
<tr class="row-even"><td><p>Hwi_restore</p></td>
<td><p>HwiP_restore</p></td>
</tr>
<tr class="row-odd"><td><p>Hwi_disableInterrupt</p></td>
<td><p>HwiP_disableInterrupt</p></td>
</tr>
<tr class="row-even"><td><p>Hwi_enableInterrupt</p></td>
<td><p>HwiP_enableInterrupt</p></td>
</tr>
<tr class="row-odd"><td><p>Hwi_clearInterrupt</p></td>
<td><p>HwiP_clearInterrupt</p></td>
</tr>
<tr class="row-even"><td><p>Hwi_post</p></td>
<td><p>HwiP_post</p></td>
</tr>
</tbody>
</table>
</section>
<section id="hw-timers">
<h3><span class="section-number">9.1.5.13. </span>HW Timers<a class="headerlink" href="#hw-timers" title="Permalink to this headline">¶</a></h3>
<p>HW Timers are not supported as part of FreeRTOS Kernel.</p>
<p>Following table compares the SysBIOS and OSAL HW Timer APIs.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SysBIOS</p></th>
<th class="head"><p>OSAL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Timer_Params_init</p></td>
<td><p>TimerP_Params_init</p></td>
</tr>
<tr class="row-odd"><td><p>Timer_construct</p></td>
<td><p>TimerP_create</p></td>
</tr>
<tr class="row-even"><td><p>Timer_destruct</p></td>
<td><p>TimerP_delete</p></td>
</tr>
<tr class="row-odd"><td><p>Timer_start</p></td>
<td><p>TimerP_start</p></td>
</tr>
<tr class="row-even"><td><p>Timer_stop</p></td>
<td><p>TimerP_stop</p></td>
</tr>
<tr class="row-odd"><td><p>Timer_setPeriodMicroSecs</p></td>
<td><p>TimerP_setPeriodMicroSecs</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="faq-important-notes-1">
<span id="faq-important-notes"></span><h2><span class="section-number">9.1.6. </span>FAQ / Important Notes<a class="headerlink" href="#faq-important-notes-1" title="Permalink to this headline">¶</a></h2>
<section id="app-performance-with-freertos-is-very-low-compared-to-sysbios">
<h3><span class="section-number">9.1.6.1. </span>App performance with FreeRTOS is very low compared to SysBIOS<a class="headerlink" href="#app-performance-with-freertos-is-very-low-compared-to-sysbios" title="Permalink to this headline">¶</a></h3>
<p>Check the MPU/Cache Settings.
Unlike SysBIOS, this is now done with CSL init.</p>
<p>SysBIOS used XDC based config to set MPU/Cache for various memory regions.</p>
<p>Refer <a class="reference internal" href="#freertos-mpu-cache-settings"><span class="std std-ref">MPU/Cache Settings in FreeRTOS</span></a> for more details.</p>
<p>In case of adding new source file to redefine the default mpu/cache settings,
make sure that this new source file is included in the build / added in makefile.</p>
</section>
<section id="application-never-reaches-main-and-startupcode-startupdata-bootcode-is-not-found-in-the-map-file">
<h3><span class="section-number">9.1.6.2. </span>Application never reaches main() and .startUpCode, .startUpData, .bootCode is not found in the map file<a class="headerlink" href="#application-never-reaches-main-and-startupcode-startupdata-bootcode-is-not-found-in-the-map-file" title="Permalink to this headline">¶</a></h3>
<p>Check the order of inclusion of various libraries.
Library listing should always be from top of SW stack to bottom.</p>
<p>Do not include <cite>csl_init</cite> lib before <cite>freertos</cite> lib.</p>
<p>See <a class="reference internal" href="#freertos-libs-inclusion"><span class="std std-ref">Building with FreeRTOS</span></a> for more details.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="freertos_ccs_rov.html" class="btn btn-neutral float-right" title="9.2. FreeRTOS Real-time Object View (ROV)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../family_cfg/jacinto/index_developer_notes_jacinto.html" class="btn btn-neutral" title="9. Developer Notes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'09_00_01',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>