

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.7.5.1. Enet EST/TAS Support &mdash; Platform Development Kit (PDK) - JACINTO User Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Platform Development Kit (PDK) - JACINTO User Guide" href="../../index.html"/>
        <link rel="up" title="4.7. ENET" href="enet.html"/>
        <link rel="next" title="4.7.6.1.2.1. Enet lwIP Example" href="enet_lwip_example.html"/>
        <link rel="prev" title="4.7.4.1. Enet LLD TSN User’s Guide" href="enet_tsn_integration.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index_jacinto.html" class="icon icon-home"> Platform Development Kit (PDK) - JACINTO User Guide
          

          
          </a>

          
            
            
              <div class="version">
                09_00_01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_release_notes_jacinto.html">2. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../family_cfg/jacinto/index_modules_jacinto.html">4. Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../csl.html">4.1. CSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../freertos.html">4.2. FreeRTOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../family_cfg/jacinto/index_modules_safertos_jacinto.html">4.3. SafeRTOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../osal.html">4.4. OSAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dss.html">4.5. DSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../csirx.html">4.6. CSIRX</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="enet.html">4.7. ENET</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="enet.html#introduction">4.7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="enet.html#user-interface">4.7.2. User Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="enet.html#lwip-integration">4.7.3. lwIP Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="enet.html#tsn-integration">4.7.4. TSN Integration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="enet.html#enet-est-tas-support">4.7.5. Enet EST/TAS Support</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.7.5.1. Enet EST/TAS Support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="enet.html#application">4.7.6. Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fvid2.html">4.8. FVID2 User Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio.html">4.9. GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">4.10. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipc.html">4.11. IPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mcan.html">4.12. MCAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mcasp.html">4.13. McASP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm.html">4.14. PM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sa.html">4.15. SA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../family_cfg/jacinto/index_modules_sciclient_jacinto.html">4.16. SCICLIENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keywriter.html">4.17. OTP KEYWRITER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">4.18. SPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ospi.html">4.19. OSPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uart.html">4.20. UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../family_cfg/jacinto/index_modules_udma_jacinto.html">4.21. UDMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pmic.html">4.22. PMIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmcsd.html">4.23. MMCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../family_cfg/jacinto/index_modules_lpm_jacinto.html">4.24. Low Power Manager (LPM)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_boot_jacinto.html">5. Bootloader (SBL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_board_jacinto.html">6. Board/EVM Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_howto_jacinto.html">7. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_faq_jacinto.html">8. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../family_cfg/jacinto/index_developer_notes_jacinto.html">9. Developer Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index_jacinto.html">Platform Development Kit (PDK) - JACINTO User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index_jacinto.html">Docs</a> &raquo;</li>
      
          <li><a href="../../family_cfg/jacinto/index_modules_jacinto.html"><span class="section-number">4. </span>Modules</a> &raquo;</li>
      
          <li><a href="enet.html"><span class="section-number">4.7. </span>ENET</a> &raquo;</li>
      
    <li><span class="section-number">4.7.5.1. </span>Enet EST/TAS Support</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="enet-est-tas-support">
<span id="enet-est-userguide"></span><h1><span class="section-number">4.7.5.1. </span>Enet EST/TAS Support<a class="headerlink" href="#enet-est-tas-support" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">4.7.5.1.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<section id="ieee-802-1qbv-est-tas">
<h3><span class="section-number">4.7.5.1.1.1. </span>IEEE 802.1Qbv EST/TAS<a class="headerlink" href="#ieee-802-1qbv-est-tas" title="Permalink to this headline">¶</a></h3>
<p>IEEE 802.1Qbv <a class="reference external" href="https://en.wikipedia.org/wiki/Time-Sensitive_Networking#IEEE_802.1Qbv_Enhancements_to_Traffic_Scheduling:_Time-Aware_Shaper">Time-Aware Shaper</a> (TAS),
which is also called <code class="docutils literal notranslate"><span class="pre">EST</span></code> in IEEE Std 802.1Q-2018, defines a mechanism to allocate
and grant exclusive Ethernet port transmission access on repeating cycles which
are divided into slices where traffic of specific traffic class queues can be
selected for transmission as per use-case requirements.</p>
<p>The diagram below shows a generic EST schedule composed of <em>n</em> slices (also
called <em>time intervals</em>), each slice has specific <em>gate mask</em> that defines the
state of each <em>transmission gate</em>: <em>open</em> or <em>closed</em>.</p>
<img alt="../../_images/EST_Schedule_Diagram.png" src="../../_images/EST_Schedule_Diagram.png" />
<p><em>Transmission gates</em> are associated with specific traffic class queues (0-7).
When a gate is <em>open</em>, frames from the corresponding queue can be selected for
transmission. When the gate is <em>closed</em>, frames from the corresponding queue
will not be selected for transmission.  It’s up to the application to determine
the duration of each time slice and the state of each transmission gate.</p>
<p>The list of all gate states for all slices in the cycle is called <em>gate control
list</em>.  The control list that is programmed is called <em>administrative list</em>,
when list becomes active is then called <em>operational list</em>.</p>
<p>For further information about TAS/EST specification, please refer to section <em>8.6.9
Scheduled traffic state machines</em> of IEEE 802.1Q-2018 standard document.</p>
</section>
<section id="guard-band">
<h3><span class="section-number">4.7.5.1.1.2. </span>Guard band<a class="headerlink" href="#guard-band" title="Permalink to this headline">¶</a></h3>
<p>It’s worth noting that in EST, the transmission of a frame will not be interrupted,
the full frame transmission will be completed even if it spills over the next
time slice.  This could pose a problem when traffic from the previous time slice,
potentially of lower priority, spills over the next time slice meant for higher
priority traffic.</p>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Time-Sensitive_Networking#IEEE_802.1Qbv_in_more_detail:_Time_slices_and_guard_bands">guard band</a>,
which is a time slice with all gates closed, can be added right before
critical time slices to ensure that wire is cleared of any previous traffic.
The duration of the guard band must be set long enough for a packet of MTU size
that initiated transmission right before the non-critical time slice ended had
been fully transmitted.</p>
</section>
<section id="enet-lld-api">
<h3><span class="section-number">4.7.5.1.1.3. </span>Enet LLD API<a class="headerlink" href="#enet-lld-api" title="Permalink to this headline">¶</a></h3>
<p>Enet LLD provides support for TAS/EST through the IOCTLs described in the <code class="docutils literal notranslate"><span class="pre">ENET_MOD_TAS</span></code> API Guide.
The most important IOCTLs are listed below:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_IOCTL_SET_STATE</span></code> Sets the state of TAS module for each MAC port</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_RESET</span></code> to reset the state machine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_ENABLE</span></code> to start EST/TAS after a valid administrative list has been programmed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_DISABLE</span></code> to stop  (idle) EST/TAS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_IOCTL_SET_ADMIN_LIST</span></code> Sets a new administrative list of type EnetTas_ControlList.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_IOCTL_GET_OPER_LIST_STATUS</span></code> Gets the status of the operational list update.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ENET_TAS_IOCTL_GET_OPER_LIST_STATUS</span></code> must be called after a new operational list has been set until driver acknowledges
that the operational list has been updated by returning <code class="docutils literal notranslate"><span class="pre">ENET_TAS_OPER_LIST_UPDATED</span></code>.
The operational list is a structure of type <code class="docutils literal notranslate"><span class="pre">EnetTas_ControlList</span></code> which is the same type used for administrative lists describer earlier.</p>
</div></blockquote>
<p>The gate control list is composed of:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>baseTime</strong> The administrative base time which determines when the administrative list will become active.
The base time can be set to a timestamp in the past, in which case the administrative list should become active right away.
The base time can also be set to a timestamp in the future, but note that not all Ethernet peripherals may fully support this feature.</p></li>
<li><p><strong>gateCmdList</strong> The actual gate control list defined as list of <em>time interval duration</em> and <em>gate state mask</em> pairs.
Enet LLD supports up to 16 intervals for simplicity, though some Ethernet peripherals may support larger number of intervals.</p></li>
<li><p><strong>listLength</strong> The number of entries in the gatecontrol list.</p></li>
<li><p><strong>cycleTime</strong> The repeating cycle time.
If it’s larger that the accumulated time of all the intervals in the control list, the last time interval gets <em>extended</em> till end of the cycle.
If it’s shorter than the accumulated interval time, then the gate control list gets <em>truncated</em> as per cycle time.</p></li>
<li><p><strong>sduTable</strong> The maximum service data unit (SDU) per queue.</p></li>
</ul>
</div></blockquote>
<p>The call sequence in the following diagram illustrates the typical usage of
Enet LLD IOCTLs to configure EST/TAS on a given MAC port.</p>
<img alt="../../_images/Cpsw_EST_Schedule_Diagram.png" src="../../_images/Cpsw_EST_Schedule_Diagram.png" />
</section>
</section>
<section id="cpsw-support">
<h2><span class="section-number">4.7.5.1.2. </span>CPSW Support<a class="headerlink" href="#cpsw-support" title="Permalink to this headline">¶</a></h2>
<section id="cpsw-est-driver-implementation">
<h3><span class="section-number">4.7.5.1.2.1. </span>CPSW EST Driver Implementation<a class="headerlink" href="#cpsw-est-driver-implementation" title="Permalink to this headline">¶</a></h3>
<p>The EST functionality in CPSW is implemented in Enet LLD through two of its Enet LLD
modules: CPTS and MAC port.</p>
<ul class="simple">
<li><p>Each Ethernet port has an <strong>EST function generator (ESTF)</strong> in the CPTS hardware
module, this is used to program the EST <em>cycle time</em>.</p></li>
<li><p>Each Ethernet transmit port has 128 locations in the CPSW global <strong>EST Fetch RAM</strong>
which is used to program the EST <em>gate control list</em>.  The EST RAM is programmed
with <em>fetch commands</em> which are composed of <em>fetch count</em> (time slice duration)
and <em>fetch allow</em> (gate mask).</p></li>
</ul>
<p>The following diagram shows the EST schedule and the relevant CPSW components.</p>
<img alt="../../_images/CpswEst_Ioctls.png" src="../../_images/CpswEst_Ioctls.png" />
<p><strong>Fetch allow</strong> is an 8-bit field, where each bit corresponds to the state of
each of the 8 gates (one per priority) in a given time slice.  The priority
being referred to in the context of EST maps to the CPSW <em>switch priority</em>
(not to be confused with other CPSW priority types: <em>packet priority</em> or
<em>header packet priority</em>).</p>
<p><strong>Fetch count</strong> value is defined in terms of wireside clock cycles, so the link
speed needs to be taken into account when computing the value to be set in
hardware. This is taken care internally by the driver as the application can
simply pass the time slice duration in nanoseconds.</p>
<p>The shortest time slice allowed by CPSW is a fetch count of 16, which corresponds
to 128 nanoseconds for 1-Gbps link or 640 nanoseconds for 100-Mbps link.
The longest time slice allowed by CPSW is determined by the length of the fetch
count field (14-bits), which corresponds to 131.064 microseconds for 1-Gbps link
or 655.32 microsecondds for 100-Mbps link.</p>
<p>The <strong>EST Fetch RAM</strong> can be configured in <em>one buffer</em> (all 128 locations operate
as single buffer) or <em>two buffer operation</em> mode (two buffers of 64 locations
each).  Enet LLD configures the EST RAM in <strong>two-buffer operation mode</strong> in order
to use one of the buffers to hold the <em>operational list</em>, while the other buffer
can be programmed with the next <em>administrative list</em>.  It’s worth noting that
only 16 of the 64 EST RAM locations are being currently used by the driver.
This limitation comes from the size of the <code class="docutils literal notranslate"><span class="pre">EnetTas_ControlList::gateCmdList</span></code>
field in TAS IOCTL, which is <code class="docutils literal notranslate"><span class="pre">ENET_TAS_MAX_CMD_LISTS</span></code>.</p>
<p>The <strong>transmit queues size</strong> is configurable in CPSW hardware via <code class="docutils literal notranslate"><span class="pre">CPSW_PN_MAX_BLKS</span></code>
and <code class="docutils literal notranslate"><span class="pre">CPSW_PN_TX_BLKS_PRI</span></code> registers.  <code class="docutils literal notranslate"><span class="pre">CPSW_PN_MAX_BLKS</span></code> can be used to set
how many 1-kB blocks of a total of 20-kB are partitioned for TX and RX.
<code class="docutils literal notranslate"><span class="pre">CPSW_PN_TX_BLKS_PRI</span></code> can be set used to specify how many of the 1-kB TX blocks
can be occupied per priority.  When all TX blocks allowed for a given priority
are used, any new frame of that priority will be dropped.</p>
<p>Note that the transmit queue sizes are not configurable via Enet LLD at the
moment.  The default setting is 16 blocks for TX and 4 for RX.
TX priority 7 can occupy all 16 blocks, priority 6 can occupy 15 blocks, …,
priority 0 can occupy only 8 blocks.</p>
<p>The following call sequence diagrams shows the steps taken by the driver when
an administrative list is being programmed and EST is then being enabled.</p>
<img alt="../../_images/CpswEst_ExampleApp.png" src="../../_images/CpswEst_ExampleApp.png" />
</section>
</section>
<section id="programing-guidelines-and-limitations">
<h2><span class="section-number">4.7.5.1.3. </span>Programing Guidelines and Limitations<a class="headerlink" href="#programing-guidelines-and-limitations" title="Permalink to this headline">¶</a></h2>
<section id="administrative-base-time">
<h3><span class="section-number">4.7.5.1.3.1. </span>Administrative base time<a class="headerlink" href="#administrative-base-time" title="Permalink to this headline">¶</a></h3>
<p>As per EST/TAS specification, the administrative base time can be set to a time
ahead (future time) or behind current time (past time).  When set to a past
time, CPSW driver will start ESTF right away.  When set to a future time,
CPSW driver will handle it differently depending on the current EST state.</p>
<ul class="simple">
<li><p>If EST is in disabled <code class="docutils literal notranslate"><span class="pre">ENET_TAS_DISABLE</span></code> or reset <code class="docutils literal notranslate"><span class="pre">ENET_TAS_RESET</span></code>,
states, then driver will allow a non-zero administrative base time,
potentially a future time.</p></li>
<li><p>If EST is in enabled state <code class="docutils literal notranslate"><span class="pre">ENET_TAS_ENABLE</span></code>, then driver will reject
any non-zero administrative base time.</p></li>
</ul>
<p>Administrative base time at a future time is implemented in the driver using
ESTF <em>timestamp comparison</em> feature, where driver can program the desired
timestamp when ESTF will start generating its output.  The EST schedule is
programmed in EST RAM in advance, the active EST buffer is also set accordingly.
This sequence is simpler to program when EST is not enabled, which is the main
motivation for the special handling described in the previous points.</p>
</section>
<section id="gate-control-list">
<h3><span class="section-number">4.7.5.1.3.2. </span>Gate control list<a class="headerlink" href="#gate-control-list" title="Permalink to this headline">¶</a></h3>
<p>The gate control list passed to the CPSW EST driver can be one of the following
types:</p>
<ul>
<li><p>Gate operation with non-zero time interval and non-zero gate mask.  This
is the <em>regular</em> gate operation for a time slice when at least one gate
priority is enabled.  User must set the time interval within the following limits:</p>
<blockquote>
<div><ul>
<li><p><em>Minimum time interval</em> is 16 wireside clocks, so the equivalent time in
nanoseconds depends on link speed.  User can refer to the
<code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_EST_TIME_MIN</span></code> macro and pass the relevant link speed.</p></li>
<li><p><em>Maximum time interval</em> is determined by the length of the fetch
count field (14-bits). User can refer to the <code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_EST_TIME_MAX</span></code>
macro and pass the relevant link speed.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Link speed</p></th>
<th class="head"><p>Min time interval (nsecs)</p></th>
<th class="head"><p>Max time interval (nsecs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 Gbps</p></td>
<td><p>128</p></td>
<td><p>131,064</p></td>
</tr>
<tr class="row-odd"><td><p>100 Mbps</p></td>
<td><p>640</p></td>
<td><p>655,320</p></td>
</tr>
<tr class="row-even"><td><p>10 Mbps</p></td>
<td><p>6,400</p></td>
<td><p>6,553,200</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Gate operation with non-zero time interval and zero gate mask.  This is the gate
operation used for guard band, intended to clear the wire for a packet in the
next time interval.  Guard band is described in more detail in next subsection.</p></li>
<li><p>Gate operation with zero time interval and non-zero gate mask.  This gate
operation will cause CPSW to hold the corresponding fetch allow for the
remaining duration of the cycle.</p>
<blockquote>
<div><ul class="simple">
<li><p>CPSW EST driver uses this gate operation type internally to handle
<em>stretch</em> case (control list duration &lt; cycle time).</p></li>
<li><p>Application can use this operation type, but it must not be followed by
a non-zero interval which is treated as error.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Gate operation with zero time and zero gate mask.  This is an invalid operation
type.</p></li>
</ul>
</section>
<section id="guard-band-2">
<h3><span class="section-number">4.7.5.1.3.3. </span>Guard band<a class="headerlink" href="#guard-band-2" title="Permalink to this headline">¶</a></h3>
<p>When computing the duration of the guard band, the user must follow the <em>zero allow</em>
guideline to compute the number of clocks needed to ensure wire is cleared from
previous packet transmission:</p>
<ul class="simple">
<li><p>1-Gbps: <cite>(maxPktLen + 4) + 292</cite>.</p></li>
<li><p>10/100-Mbps: <cite>((maxPktLen + 4) * 2) + 292</cite>.</p></li>
</ul>
<p>where <em>maxPktLen</em> is the maximum packet length (excluding FCS) in the previous
time interval.</p>
<p>For example, the guard band for 2020 bytes max frame size in the previous time
slot in a 100-Mbps link, the <em>zero allow</em> should be: <cite>((2020 + 4) * 2) + 292 = 4340</cite>.</p>
<p>Just like any other time interval, the duration of the guard band passed to
the driver has to be in nanoseconds but the zero allow values computed previuosly
is in wireside clocks, so it must be converted to nanoseconds:</p>
<ul class="simple">
<li><p>1-Gbps: <cite>((maxPktLen + 4) + 292) * 8</cite>.</p></li>
<li><p>100-Mbps: <cite>(((maxPktLen + 4) * 2) + 292) * 40</cite>.</p></li>
<li><p>10-Mbps: <cite>(((maxPktLen + 4) * 2) + 292) * 400</cite>.</p></li>
</ul>
<p>A helper macro <code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_EST_GUARD_BAND</span></code> is provided to compute the
guard band duration.  User must pass the link speed (<cite>1G</cite>, <cite>100M</cite> or <cite>10M</cite>) and
the maximum packet length in the previuos time interval (excluding FCS).</p>
<p>For more details about the <em>zero allow</em> duration guideline, please refer to
the TRM section called <em>EST fetch values</em>, in the CPSW chapter.</p>
</section>
<section id="link-down-event">
<h3><span class="section-number">4.7.5.1.3.4. </span>Link-down event<a class="headerlink" href="#link-down-event" title="Permalink to this headline">¶</a></h3>
<p>As described in <code class="docutils literal notranslate"><span class="pre">enet_est_cpsw_driver</span></code> section, the <em>fetch allow</em>
value programmed into EST RAM is in wireside clocks, so the link speed needs
to be taken into account when computing the allow value from a desired time
interval duration in microseconds.</p>
<p>When link is lost, the previous link speed is no longer valid or relevant,
hence CPSW driver will clear the previous operational list programmed in
EST RAM as part of its link lost event handling.</p>
<p>This also implies that application has to program again an administrative
control list via <code class="docutils literal notranslate"><span class="pre">ENET_TAS_IOCTL_SET_ADMIN_LIST</span></code> command when link is
back up.  Enet LLD will not automatically restore the previous control list.</p>
</section>
<section id="limitations">
<h3><span class="section-number">4.7.5.1.3.5. </span>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h3>
<p>The following EST features are not supported by the driver:</p>
<ul class="simple">
<li><p>Administrative cycle time different from current operational cycle time is not supported.</p></li>
<li><p>Administrative cycle time extension is not supported.</p></li>
<li><p>Configuration of Maximum SDU table is not supported.</p></li>
<li><p>Administrative list needs to be configured again by application after link down
events.</p></li>
</ul>
<p>The following EST features have limited support in the driver:</p>
<ul class="simple">
<li><p>Administrative base time at a future time is only supported when EST is not enabled.</p></li>
<li><p>Time slices longer than 131.064 microseconds (1-Gpbs) or 655.32 microseconds (100-Mbps)
will be rejected by the driver.  It’s up to the application to add two or more
consecutive slots with same gate mask to accommodate for longer time slices.</p></li>
</ul>
</section>
</section>
<section id="debugging-and-troubleshooting">
<h2><span class="section-number">4.7.5.1.4. </span>Debugging and Troubleshooting<a class="headerlink" href="#debugging-and-troubleshooting" title="Permalink to this headline">¶</a></h2>
<section id="est-timestamping">
<h3><span class="section-number">4.7.5.1.4.1. </span>EST Timestamping<a class="headerlink" href="#est-timestamping" title="Permalink to this headline">¶</a></h3>
<p>EST packet timestamping can be used as an aid for debugging purposes to verify
if packets are being transmitted at the expect time based on the programmed EST
schedule.  CPSW supports four types of <strong>timestamping modes</strong>:</p>
<ul class="simple">
<li><p>Timestamp all packets on any priority.</p></li>
<li><p>Timestamp all packets of given priority.</p></li>
<li><p>Timestamp the first packet in each time interval (time slice).</p></li>
<li><p>Timestamp the first packet of a given priority in the time interval.</p></li>
</ul>
<p>CPSW driver provides the following private <strong>EST timestamp related IOCTLs</strong> to
<em>enable</em>, <em>disable</em> and <em>retrieve</em> the generated EST timestamp events:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_IOCTL_EST_ENABLE_TIMESTAMP</span></code>. Enables EST packet timestamping
according to the requested configuration <code class="docutils literal notranslate"><span class="pre">CpswMacPort_EstTimestampCfg</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>CpswEstTsMode</cite> One of the four <cite>CpswEstTsModeTypes</cite> described earlier.</p></li>
<li><p><cite>CpswEstTsPri</cite> Only packets with this priority will be timestamped.
Applicable to <code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_EST_TIMESTAMP_ONEPRI</span></code> and
<code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_EST_TIMESTAMP_FIRST_ONEPRI</span></code> modes only.</p></li>
<li><p><cite>CpswEstTsDom</cite> EST timestamped events will have this domain id when
retrieved from CPTS.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_IOCTL_EST_DISABLE_TIMESTAMP</span></code>. Disables EST packet timestamping.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPSW_CPTS_IOCTL_LOOKUP_EST_EVENT</span></code>. Retrieves EST timestamps from CPTS
driver using a match criteria (CpswCpts_EstEventMatchParams) of MAC port number
and domain.  The domain should be the same one used during enable phase in
<code class="docutils literal notranslate"><span class="pre">CPSW_MACPORT_IOCTL_EST_ENABLE_TIMESTAMP</span></code>.</p></li>
</ul>
<p>Apart from the actual timestamp value in nanoseconds, the EST timestamp events
<code class="docutils literal notranslate"><span class="pre">CpswCpts_EstEvent</span></code> also carry information about the priority (CPSW <em>switch
priority</em>), sequence number, ingress port (host port or another MAC port where
packet was initially received), egress port (the MAC port where EST packet was
transmitted) and the domain number.</p>
<p>Just like with any other CPTS event, CPSW driver services the CPTS interrupt
that is generated for each EST timestamp event, pops the event from the
CPTS FIFO and copies the event information into a software pool.  The timestamp
event will reside in this software pool until the application reads it through
<code class="docutils literal notranslate"><span class="pre">CPSW_CPTS_IOCTL_LOOKUP_EST_EVENT</span></code> command.  This process will consume
additional CPU cycles so it’s advised that this feature is not kept permanently
enabled.</p>
<p>The CPTS software pools <code class="docutils literal notranslate"><span class="pre">ENET_CFG_CPSW_CPTS_EVENTS_POOL_SIZE</span></code> need to be sized
properly to accommodate for bursty traffic.  Driver will overwrite oldest events
in the pool as it handles new timestamp events.</p>
</section>
<section id="ccs-debug-gel-files">
<h3><span class="section-number">4.7.5.1.4.2. </span>CCS Debug GEL Files<a class="headerlink" href="#ccs-debug-gel-files" title="Permalink to this headline">¶</a></h3>
<p>CPSW debug GEL files can be loaded by loading the startup GEL file which can be
located at <em>pdk/packages/ti/drv/enet/tools/debug_gels</em>.</p>
<p>The following image shows the EST GEL files once they have been loaded into CCS.</p>
<img alt="../../_images/EST_debug_gel.png" src="../../_images/EST_debug_gel.png" />
<p>The available GEL functions are:</p>
<ul>
<li><p><em>cpsw_est_show_global_config</em>. Shows the global EST enable configuration as well
as few other relevant fields of <cite>CPSW_CONTROL</cite> register.</p></li>
<li><p><em>cpsw_est_show_config</em>. Shows the MAC port relevant configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>EST enable.</p></li>
<li><p>EST control: buffer mode (one or two buffer), selected buffer, timestamp configuration.</p></li>
<li><p>EST status: active buffer.</p></li>
<li><p>MAC control: gigabit enable, full-duplex configuration.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><em>cpsw_est_dump_ram</em>.  Dumps the non-zero EST RAM locations. Due to two-buffer mode used by the driver,
expectation is to see non-zero locations at:</p>
<blockquote>
<div><ul class="simple">
<li><p>Indexes 0, 1, 2, …, when buffer 1 is active.</p></li>
<li><p>Indexes 63, 64, 65, …,  when buffer 2 is active.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><em>cpsw_cpts_show_global_config</em>. Shows relevant CPTS global configuration which affects all ESTF instandes.</p>
<blockquote>
<div><ul class="simple">
<li><p>Global CPTS configuration in <cite>CPTS_CONTROL</cite> register, such as CPTS enable, mode (32 or 64-bit), among others.</p></li>
<li><p>CPTS timestamp add value in <cite>CPTS_TS_ADD_VAL</cite> register.  Useful to infer the CPTS reference clock frequency:
<cite>TS_ADD_VAL + 1</cite> is the timestamp increment value per CPTS clock pulse.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><em>cpsw_cpts_estf_show_config</em>. Shows the MAC port ESTF configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>Admin base time is configured in <cite>ESTF_COMP_HIGH</cite> (32 msbits) and <cite>ESTF_COMP_LOW</cite> (32 lsbits) fields.</p></li>
<li><p>Cycle time is configured in <cite>ESTF_LENGTH</cite> field: <cite>ESTF_LENGTH*(TS_ADD_VAL + 1)</cite> is the cycle duration in nanoseconds.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="enet_lwip_example.html" class="btn btn-neutral float-right" title="4.7.6.1.2.1. Enet lwIP Example" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="enet_tsn_integration.html" class="btn btn-neutral" title="4.7.4.1. Enet LLD TSN User’s Guide" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'09_00_01',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>